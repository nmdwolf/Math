\chapter{\difficult{Topos theory}}\label{chapter:topos}

    The main reference for this chapter is~\citet{johnstone_topos_2014,caramello_lectures_2019}. For an introduction to stacks and descent theory, see~\cite{vistoli_notes_2004}.

\section{Elementary topoi}

    \newdef{Subobject classifier}{\index{subobject!classifier}
        Consider a finitely complete category (in fact, the existence of a terminal object suffices). A subobject classifier is a mono\footnote{The symbol for this morphism will become clear in \cref{section:internal_logic}.} $\texttt{true}:1\hookrightarrow\Omega$ from the terminal object such that for every mono $\phi:x\hookrightarrow y$ there exists a unique morphism $\chi:y\rightarrow\Omega$ that fits in the following pullback square:
        \begin{figure}[ht!]
            \centering
            \begin{tikzpicture}
                \node (A) at (0, 0) {$x$};
                \node (B) at (0, -2) {$y$};
                \node (1) at (2, 0) {$1$};
                \node (O) at (2, -2) {$\Omega$};
                \node at (1, -1) {pb};
                \draw[->] (A) -- (1);
                \draw[right hook->] (A) -- node[left]{$\phi$} (B);
                \draw[right hook->] (1) -- node[right]{$\texttt{true}$} (O);
                \draw[->] (B) -- node[below]{$\exists!\chi$} (O);
            \end{tikzpicture}
            \caption{Subobject classifier.}
            \label{fig:subobject_classifier}
        \end{figure}
    }
    \begin{adefinition}
        Consider a well-powered category $\mathbf{C}$. The assignment of subobjects $\mathrm{Sub}(x)$ to an object $x\in\ob{C}$ defines functor $\mathrm{Sub}:\mathbf{C}^{op}\rightarrow\mathbf{Set}$. A subobject classifier $\Omega$ is a representation of this functor, i.e.~the following isomorphism is natural in $x$:
        \begin{gather}
            \mathrm{Sub}(x)\cong\mathbf{C}(x,\Omega)\,.
        \end{gather}
    \end{adefinition}

    \begin{example}[Indicator function]\index{indicator function}
        The category $\mathbf{Set}$ has the 2-element set $\{\texttt{true},\texttt{false}\}$ as subobject classifier. The morphism $\chi:S\rightarrow\Omega$ is the indicator function
        \begin{gather}
            \chi_S(x)=
            \begin{cases}
                \texttt{true}&x\in S\,,\\
                \texttt{false}&x\not\in S\,.
            \end{cases}
        \end{gather}
    \end{example}

    \newdef{Elementary topos}{\index{topos!elementary}
        An elementary topos is a finitely complete, Cartesian closed category (\cref{cat:closed}) admitting a subobject classifier. Equivalently, one can define an elementary topos as a finitely complete category that has all power objects exist.

        The power object $Px$ of $x\in\ob{\mathcal{E}}$ is related to the subobject classifier $\Omega$ by the following relation:
        \begin{gather}
            \label{topos:power_exponential}
            Px = \Omega^x\,.
        \end{gather}
    }
    \begin{remark}[Finite colimits]
        The original definition by \textit{Lawvere} also required the existence of finite colimits. However, it can be proven that finite cocompleteness follows from the other axioms.
    \end{remark}

    \begin{theorem}[Fundamental theorem of topos theory]\index{fundamental theorem!of topos theory}
        Let $\mathcal{E}$ be an elementary topos. The slice category $\mathcal{E}/x$ is also a topos for every object $x\in\ob{\mathcal{E}}$. The subobject classifier is given by $\pi_2:\Omega\times x\rightarrow x$.
    \end{theorem}

    \begin{property}[Balanced]
        All monos in a topos are regular. Hence, every mono arises as an equalizer. Since every epic equalizer is necessarily an isomorphism (\cref{cat:regular_iso}), it follows that every topos is balanced (\cref{cat:balanced}).
    \end{property}

    \begin{property}[Epi-mono factorization]\index{image}
        Every morphism $f:x\rightarrow y$ in a topos factorizes uniquely as an epi followed by a mono:
        \begin{gather}
            x\overset{e}{\twoheadrightarrow}z\overset{m}{\hookrightarrow}y\,.
        \end{gather}
        The mono is called the \textbf{image} of $f$.
    \end{property}

\section{Morphisms}

    \newdef{Base change}{\index{base change}\label{topos:base_change}
        Consider a category $\mathbf{C}$ with pullbacks. For every morphism $f:x\rightarrow y$ one can define a functor $f^*:\mathbf{C}/y\rightarrow\mathbf{C}/x$. This functor acts by pullback along $f$.
    }
    \newdef{Dependent sum and product}{\index{dependent!sum/product}\label{topos:dependent_functors}
        Consider a base change functor $f^*$. The dependent sum and product functors are given by the right and left adjoints (if they exist):
        \begin{gather}
            \label{topos:dependent_adjoint_triple}
            \sum_f\dashv f^*\dashv \prod_f\,.
        \end{gather}
    }
    \begin{remark}
        The dependent sum can be shown to exist over any category. In fact, as a functor, it is simply given by postcomposition with $f$. However, the interpretation is much less trivial. Any morphism can be interpreted as a ``space'' with fibres the preimages. For example, in $\mathbf{Set}$, a morphism $g:Z\rightarrow X$ represents $Z$ as follows: \[Z\cong\bigsqcup_{x\in X}g^{-1}(x)\equiv\sum_{x:X}g^{-1}(x).\] The dependent sum generalizes this construction in a fibrewise manner, i.e.~the fibre over a point $y\in Y$ is given by
        \begin{gather}
            \sum_fg\,\Big|_y = \bigsqcup_{x\in f^{-1}(y)}g^{-1}(x)\,.
        \end{gather}
        Instead of combining all fibres into a single space, it combines those that lie in a single fibre of $f$.
    \end{remark}

    Although the dependent sum always exists, the dependent product requires more structure (see e.g.~\citet{huang_locally_2022}).
    \begin{property}[Locally Cartesian closed categories]
        In a locally Cartesian closed category (\cref{cat:closed}), all dependent products exist. In fact, the existence of the adjoint triple~\eqref{topos:dependent_adjoint_triple} is equivalent to $\mathbf{C}$ being locally Cartesian closed. For example, in $\mathbf{Set}$, the dependent product is given by
        \begin{gather}
            \label{topos:dependent_product_sets}
            \prod_fg\,\Big|_y=\prod_{x\in f^{-1}(y)}g^{-1}(x)\,.
        \end{gather}
        When $f$ is the terminal morphism, this represents the space of sections $X\rightarrow Z\equiv\sum_{x:X}g^{-1}(x)$ of $g$.

        More generally, the functor is obtained through the product-exponential adjunction in slice categories. The pullback is equal to a product in a slice category. Since $\mathbf{C}$ is locally Cartesian, one obtains for all $p:a\rightarrow y$ and $q:b\rightarrow y$:
        \begin{gather}
            \mathbf{C}/x(p\times f,q)\cong\mathbf{C}/y(p,q^f)
        \end{gather}
        for some morphism $q^f:b^f\rightarrow y$. Applying this exponential functor to the identity morphism $\mathbbm{1}_f$ gives a morphism $s:\mathbbm{1}_y\rightarrow f^f$ or $s:y\rightarrow x^f$ (this simply picks out the identity morphism in the exponential object internally). The dependent product is then defined as the pullback $\prod_fg:=s^*g^f$, where $g^f$ is interpreted as the morphism $(f\circ g)^f\rightarrow f^f$ in $\mathbf{C}/y$.

        The idea behind this pullback construction is that in $\mathbf{Set}$, the pullback of $g^X:Z^X\rightarrow X^X$ along $s:\mathbbm{1}_X\rightarrow X^X$ is equal to the set \[\{h\in Z^X\mid h\circ g=\mathbbm{1}_Z\}\,,\] i.e.~it consists of all sections of $g$. Hence, the pullback construction generalizes \cref{topos:dependent_product_sets}.
    \end{property}

    \newdef{Logical morphism}{\index{morphism!logical}
        A functor $f:\mathcal{E}\rightarrow\mathcal{F}$ between elementary topoi is said to be logical if it preserves finite limits, exponential objects and the subobject classifier.
    }
    \begin{property}
        If a logical morphism has a left adjoint, it also has a right adjoint.
    \end{property}

    \newdef{Geometric morphism}{\index{morphism!geometric}\index{direct!image}\index{inverse!image}
        A geometric morphism $f:\mathcal{E}\rightarrow\mathcal{F}$ of elementary topoi consists of an adjunction \[\mathcal{E}\adj{f^*}{f_*}\mathcal{F}\,,\] where the left adjoint is left exact. The right adjoint $f_*$ is called the \textbf{direct image} part of $f$ and the left adjoint $f^*$ is called the \textbf{inverse image} part. If $f^*$ itself has a left adjoint, then $f$ is said to be \textbf{essential}.
    }
    \newdef{Geometric embedding}{\index{embedding}\index{sub-!topos}\index{level}
        A geometric morphism for which the direct image part is fully faithful. If $\mathcal{E}\hookrightarrow\mathcal{F}$ is a geometric embedding, $\mathcal{E}$ is sometimes called a \textbf{subtopos} of $\mathcal{F}$. Moreover, if it is an essential geometric morphisms, the subtopos is itself said to be \textbf{essential}. Essential subtopoi $\mathcal{E}\hookrightarrow\mathcal{F}$ are also called \textbf{levels} of $\mathcal{F}$.
    }
    \begin{property}[Characterization of geometric embeddings]\label{topos:characterization_embedding}
        Let $f:\mathcal{E}\hookrightarrow\mathcal{F}$ be a geometric embedding and let $W\subset\mathrm{hom}(\mathcal{F})$ be the collection of morphisms that are mapped to isomorphisms under $f^*$. $\mathcal{E}$ is both equivalent to the full subcategory of $\mathcal{F}$ on $W$-local objects (\cref{cat:local_object}) and the localization $\mathcal{F}[W^{-1}]$ at $W$ (\cref{model:localization}).
    \end{property}

    \begin{property}[Base change]
        The base change functors on a topos are logical and admit a left adjoint, the postcomposition functor. This implies that these functors can be refined to essential geometric morphisms.
    \end{property}

    \begin{example}[Topological spaces]\label{topos:topological_spaces}
        Every continuous function $f:X\rightarrow Y$ induces a geometric morphism
        \begin{gather}
            \mathbf{Sh}(X)\adj{f^*}{f_*}\mathbf{Sh}(Y)\,,
        \end{gather}
        where the direct image functor $f_*$ is defined as
        \begin{gather}
            f_*F(U) := F(f^{-1}U)
        \end{gather}
        for any sheaf $F\in\mathbf{Sh}(X)$ and any open subset $U\in\mathbf{Open}(Y)$. The inverse image functor $f^*$ is defined using the equivalence between sheaves on topological spaces and \'etal\'e spaces. Consider a sheaf $E\in\mathbf{Sh}(Y)$ as an \'etal\'e space $\pi:E\rightarrow Y$. The inverse image of $E$ along a continuous function $f:X\rightarrow Y$ is the pullback of $\pi$ along $f$.
    \end{example}

    This example implies that the global elements $\ast\rightarrow X$ of a topological space induce geometric morphisms of the form $\mathbf{Sh}(\ast)\rightarrow\mathbf{Sh}(X)$. By noting that $\mathbf{Sh}(\ast)=\mathbf{Set}$, one obtains the following generalization.
    \newdef{Point}{\index{point}
        A point of a topos $\mathcal{E}$ is a geometric morphism $\mathbf{Set}\rightarrow\mathcal{E}$.
    }

    \newnot{Category of topoi}{
        \nomenclature[S_Topos]{$\mathbf{Topos}$}{the 2-category of (elementary) topoi and geometric morphisms}
        The category of elementary topoi and geometric morphisms is a 2-category. It is denoted by $\mathbf{Topos}$.

        However, to obtain the structure of a 2-category, one needs to define an appropriate notion of 2-morphism. Because a geometric morphism consists of an adjunction, one can consider two distinct conventions. Either one can choose the 2-morphisms in $\mathbf{Topos}$ to be the natural transformations $f^*\Rightarrow g^*$ (with associated transformations $g_*\Rightarrow f_*$) or one can choose them to be the natural transformations $f_*\Rightarrow g_*$ (and associated transformations $g^*\Rightarrow f^*$). This chapter follows~\cite{johnstone_topos_2014} and the ``inverse image convention'' is used, i.e.~a 2-morphism $f\Rightarrow g$ consists of natural transformations $f^*\Rightarrow g^*$ and $g_*\Rightarrow f_*$.
    }

\section{Internal logic}\label{section:internal_logic}

    In this subsection finitely complete categories that admit a subobject classifier are considered (they do not have to be elementary topoi).

    \newdef{Truth value}{\index{truth value}
        A global element of the subobject classifier, i.e.~a morphism $1\rightarrow\Omega$. The subobject classifier $\Omega$ is also sometimes called the \textbf{object of truth values}.
    }

    \begin{property}[Heyting algebra]\label{topos:heyting_algebra}
        For all objects $x$ in an elementary topos, the poset of subobjects $\mathrm{Sub}(x)$ has the structure of an internal meet-semilattice since forming pullbacks of monos gives a natural transformation
        \begin{gather}
            \cap_X:\hom(X,\Omega\times\Omega)\rightarrow\hom(X,\Omega)\,.
        \end{gather}
        By the Yoneda lemma this induces an internal map
        \begin{gather}
            \land:\Omega\times\Omega\rightarrow\Omega\,.
        \end{gather}
        In fact it can be shown that this gives the structure of an internal
        Heyting algebra (\cref{set:heyting}) and, in particular, that of an internal locale (\cref{topology:locale}). Hence, every topos canonically gives an external Heyting algebra, namely $\mathrm{Sub}(1)$. Furthermore, every power object is an internal Heyting algebra. This in particular includes the subobject classifier $\Omega=P1$.
    \end{property}

    \newdef{Mitchell--B\'enabou language}{\index{Mitchell--B\'enabou language}\index{proposition}\index{type}\index{variable}\index{term}
        Let $\mathcal{E}$ be an elementary topos with subobject classifier $\Omega$.
        \begin{enumerate}
            \item\textbf{Type}: An object $x\in\ob{\mathcal{E}}$.
            \item\textbf{Variable} (of type $x$): An identity morphism $\mathbbm{1}_x$.
            \item\textbf{Term} (of type $x$ in variables $\alpha_i$ of type $x_i$): a morphism $\prod_{i\in I}x_i\rightarrow x$.
            \item\textbf{Formula} or \textbf{proposition}: a term of type $\Omega$. Moreover, a formula is deemed true if it factors through $\mathtt{true}:1\rightarrow\Omega$.
        \end{enumerate}
        The logical connectives are induced by the internal Heyting structure on $\Omega$. Quantifiers are induced by the (internal) completeness of $\Omega$.

        Every type also comes equipped with two binary relations:
        \begin{enumerate}
            \item $=_x$ is obtained from the characteristic morphism of the diagonal inclusion.
            \item $\in_x$ is obtained by using the evalution map of the exponential object together with \cref{topos:power_exponential}.
        \end{enumerate}
        Since the slices of an elementary topos are themselves elementary topoi, one can also define dependent types. An \textbf{indexed type} is an object of a slice category. \textbf{(Dependent) sums} and \textbf{products} of type families are goven by the left and right adjoints to the base change functor.
    }

    An interpretation of the Mitchell--B\'enabou language in an elementary topos $\mathcal{E}$ goes as follows.
    \newdef{Kripke--Joyal semantics}{\index{Kripke--Joyal semantics}\index{entailment}
        The \textbf{entailment} $U\vdash\phi(\alpha)$ for a term $\alpha:U\rightarrow X$ and a proposition $\phi(x):X\rightarrow\Omega$ is said to hold if $\alpha$ factors through the pullback $\{x\in X\mid\phi(x)\}$.
    }

    \begin{property}[Monotonicity]
        If $V\vdash\phi(\alpha)$ and $f:U\rightarrow V$, then $U\vdash\phi(\alpha\circ f)$.
    \end{property}
    \begin{property}[Locality]
        If $f:U\rightarrow V$ is epic and $V\vdash\phi(\alpha\circ f)$, then $U\vdash\phi(\alpha)$.
    \end{property}

    ?? COMPLETE ??

\section{Grothendieck topoi}\label{section:grothendieck_topos}
\subsection{Grothendieck topologies}

    \newdef{Sieve}{\index{sieve}
        Let $\mathbf{C}$ be a small category. A sieve $S$ on $\mathbf{C}$ is a fully faithfull discrete fibration $S\hookrightarrow\mathbf{C}$.

        A sieve $S$ on an object $x\in\mathbf{C}$ is a sieve in the slice category $\mathbf{C}/x$. This means that $S$ is a subset of $\mathrm{ob}(\mathbf{C}/x)$ that is closed under precomposition, i.e.~if $y\rightarrow x\in S$ and $z\rightarrow y\in\mathrm{hom}(\mathbf{C})$, then $z\rightarrow y\rightarrow x\in S$.

        All of this can be summarized by saying that a sieve on an object $x\in\ob{C}$ is a subfunctor of the hom-functor $\mathbf{C}(-,x)$.
    }

    \begin{example}[Maximal sieve]
        Let $\mathbf{C}$ be a category. The maximal sieve on $x\in\ob{C}$ is the collection of all morphisms $\{f\in\mathrm{hom}(\mathbf{C})\mid\cod(f)=x\}$ or, equivalently, all of $\mathrm{ob}(\mathbf{C}/x)$.
    \end{example}
    \begin{example}[Pullback sieve]
        Consider a morphism $f:x\rightarrow y$. Given a sieve $S$ on $y$, one can construct the pullback sieve $f^*S$ on $x$ as the sieve of morphisms in $S$ that factor through $f$:
        \begin{gather}
            f^*S(x) = \bigl\{g\bigm\vert f\circ g\in S(y)\bigr\}\,.
        \end{gather}
    \end{example}

    \newprop{Presheaf topos}{\index{presheaf!topos}\label{topos:presheaf_topos}
        Consider the presheaf category $\mathbf{Psh}(\mathbf{C})$ on an arbitrary (small) category $\mathbf{C}$. This category is an elementary topos, where the subobject classifier assigns sieves:
        \begin{gather}
            \underline{\Omega}(x) := \{S\mid S\text{ is a sieve on }x\}\,.
        \end{gather}
        The action on a morphism $f:x\rightarrow y$ gives the morphism $\underline{\Omega}(f)$ that sends a sieve $S$ to its pullback sieve $f^*S$.

        The morphism $\texttt{true}:\underline{1}\hookrightarrow\underline{\Omega}$ is defined as the natural transformation assigning to every object its maximal sieve. For every subobject $\underline{Y}\hookrightarrow\underline{X}$ the characteristic morphism $\chi_{_{\underline{Y}}}$ is defined as follows. Consider an object $c\in\ob{C}$. The component $\chi_{_{\underline{Y}}}|_c$ is then given by
        \begin{gather}
            \chi_{_{\underline{Y}}}|_c(x) := \bigl\{f\in\mathbf{C}(d,c)\mid\underline{X}(f)(x)\in\underline{Y}(d)\bigr\}\,,
        \end{gather}
        for all $x\in\underline{X}(c)$.
    }

    The following definition is due to \textit{Giraud} (for the original definition using the notion of a \textit{cover}, see the end of this section).
    \newdef{Grothendieck topology}{\index{Grothendieck!topology}\index{covering!sieve}
        A Grothendieck topology on a category is a map $J$ assigning to every object a collection of sieves satisfying the following conditions:
        \begin{enumerate}
            \item\textbf{Identity}\footnote{The name itself stems from the fact that the maximal sieve is generated from the identity morphism.}: For every object $x$ the maximal sieve $M_x$ is an element of $J(x)$ or, equivalently, all sieves generated by isomorphisms are in $J(x)$.
            \item\textbf{Base change}: If $S\in J(x)$, then $f^*S\in J(y)$ for every morphism $f:y\rightarrow x$.
            \item\textbf{Locality}: Consider a sieve $S$ on $x$. If there exists a sieve $R\in J(x)$, such that for every morphism $(f:y\rightarrow x)\in R$ the pullback sieve $f^*S\in J(y)$, then $S\in J(x)$.
        \end{enumerate}
        The sieves in $J$ are called ($J$-)\textbf{covering sieves}. A collection of morphisms with codomain $x\in\ob{C}$ is called a \textbf{cover}\footnote{Sometimes this term is also used to denote any collection of morphism with common codomain $x$, i.e.~without reference to a covering sieve.} of $x$ if the sieve generated by these morphisms is a covering sieve on $x$.
    }
    \begin{example}[Topological spaces]
        These conditions have the following interpretation in the case of topological spaces:
        \begin{itemize}
            \item The collection of all open subsets covers a space $U$.
            \item If $\{U_i\}_{i\in I}$ covers $U$, then $\{U_i\cap V\}_{i\in I}$ covers $U\cap V$.
            \item If $\{U_i\}_{i\in I}$ covers $U$ and if for every $i\in I$ the collection $\{U_{ij}\}_{j\in J_i}$ covers $U_i$, then $\{U_{ij}\}_{i\in I,j\in J_i}$ covers $U$.
        \end{itemize}
        The canonical Grothendieck topology on $\mathbf{Open}(X)$ is given by the sieves $S=\{U_i\hookrightarrow U\}_{i\in I}$, where $\bigcup_{i\in I}U_i=U$. This topology is denoted by $J_{\mathbf{Open}(X)}$.
    \end{example}

    \newdef{Site}{\index{site}
        A (small) category equipped with a Grothendieck topology $J$.
    }

    A slightly weaker notion than that of a (Grothendieck) topology is the following.
    \newdef{Coverage}{\index{coverage}\index{cover}\label{topos:coverage}
        Let $\mathbf{C}$ be a category. A coverage on $\mathbf{C}$ is a map that assigns to every object $x\in\ob{C}$ a collection of families $\{f:y\rightarrow x\}\subset\mathrm{hom}(\mathbf{C})$, the \textbf{covering families} or \textbf{covers}, satisfying the following condition. If $\{f:y\rightarrow x\}$ is a covering family on $x$, then for every morphism $g:x'\rightarrow x$ there exists a covering family $\{f':y'\rightarrow x'\}$ on $x'$ such that every composite $g\circ f'$ factors through some $f$.
    }

    \newdef{Matching family}{\index{matching!family}\label{topos:matching_family}
        Consider a presheaf $F\in\mathbf{Psh(C)}$ together with a sieve $S$ on $x\in\ob{C}$. A matching family for $S$ with respect to $F$ is a natural transformation $\alpha:S\Rightarrow F$ between $S$, regarded as a subfunctor of $\mathbf{C}(-,x)$, and $F$.

        More explicitly, it is an assignment of an element $x_f\in Fd$ to every morphism $(f:y\rightarrow x)\in S$ such that
        \begin{gather}
            F(g)(x_f) = x_{f\circ g}
        \end{gather}
        for all morphisms $g:z\rightarrow y$. Equivalently, a matching family for $S$ with respect to $F$ is a set of elements $\{x_f\}_{f\in S}$ such that for all covering morphisms $f:y\rightarrow x,g:z\rightarrow x\in S$ and all morphisms $f':c\rightarrow y, g':c\rightarrow z$ such that $f\circ f'=g\circ g'$ the following equations holds:
        \begin{gather}
            \label{topos:matching_family_condition}
            F(f')(x_f)=F(g')(x_g)\,.
        \end{gather}
        Given such a matching family, one calls an element $a\in Fx$ an \textbf{amalgamation} if it satisfies
        \begin{gather}
            F(f)(a)=x_f
        \end{gather}
        for all morphisms $f\in S(y)$. The existence of such an element can also be stated in terms of natural transformations. Consider the obvious inclusion $\iota_S$ of $S$ into the the hom-functor $\mathbf{C}(-,x)$. Every morphism with codomain $x$ can be obtained from the identity morphism by precomposition and, hence, a natural transformation $\mathbf{C}(-,x)\Rightarrow F$ is determined by its action on the identity morphisms $\mathbbm{1}_x$. The existence of an amalgamation is thus equivalent to the existence of an extension of $S$ along $\iota_S$.
    }
    \remark{If the base category has all pullbacks, for example if it is a topos on its own, one can restrict the above commuting diagrams to the pullback diagrams of morphisms in the sieve $S$.}

    \newdef{Sheaf}{\index{sheaf}\index{presheaf!separated}\label{topos:sheaf}
        \nomenclature[S_Shsite]{$\mathbf{Sh}(\mathbf{C},J)$}{category of $J$-sheaves on a site $(\mathbf{C},J)$}
        Consider a site $(\mathbf{C},J)$. A presheaf $F$ on $\mathbf{C}$ is called a $J$-sheaf if every matching family for every covering sieve in $J$ admits a unique amalgamation\footnote{If there exists at most one amalgamation, the presheaf is said to be \textbf{separated}.} or, equivalently, if all sieves admit a unique extension to representable presheaves.

        The category $\mathbf{Sh}(\mathbf{C},J)$ of $J$-sheaves on the site $(\mathbf{C},J)$ is the full subcategory of $\mathbf{Psh(C)}$ on the presheaves that satisfy the above condition.
    }
    This definition can also be restated in terms of local objects (\cref{cat:local_object}).
    \newadef{Sheaf}{\index{descent}\label{topos:local_object_sheaf}
        By definition every covering sieve admits a morphism into the Yoneda embedding: $\eta:S\hookrightarrow\mathcal{Y}x$. If the collection of all these morphisms is denoted by $\mathcal{S}$, a presheaf is a sheaf if and only if it is $\mathcal{S}$-local, i.e.~if the following morphism is an isomorphism for all $\eta\in\mathcal{S}$:
        \begin{gather}
            Fx\cong\mathbf{Psh}(\mathcal{Y}x,F)\xrightarrow{\mathbf{Psh}(\eta, F)}\mathbf{Psh}(S,F)\,.
        \end{gather}
        This is also called the \textbf{descent condition} for sheaves. In this context the collection of matching families $\mathrm{Match}(S,F):=\mathbf{Psh}(S,F)$ for a sieve $S$ with respect to a presheaf $F$ is often called the \textbf{descent object} of $S$ with respect to $F$.
    }

    \begin{example}[Topological spaces]
        The usual category of sheaves $\mathbf{Sh}(X)$ on a topological space $X$ is obtained as the category of sheaves on the site $(\mathbf{Open}(X),J_{\mathbf{Open}(X)})$. Since the morphisms in the covering sieves are exactly the inclusion maps $U_i\hookrightarrow U$, the pullback of two such morphisms is given by the intersection $U_i\cap U_j$. Hence, the condition for a matching family, as formulated in \cref{topos:matching_family} above, gives the second part of \cref{sheaf:def}. The uniqueness of an amalgamation is equivalent to the first part of that definition.

        For topological spaces, sheaves are easily represented visually. A matching family assigns to every set $U_i$ of an open cover $\mathcal{U}\equiv\{U_i\}_{i\in I}$ of $U$ an element $x_i\in FU_i$, such that the restrictions coincide on double overlaps, as in step $(1)$ in the figure below.
        \begin{gather*}
            \begin{tikzpicture}[baseline=-1mm]
                \node (title) at (0, 2) {Cover};
                \node (Uij) at (0, 1) {$U_i\cap U_j$};
                \node (Ui) at (-1, 0) {$U_i$};
                \node (Uj) at (1, 0) {$U_j$};
                \node (U) at (0, -1) {$U$};
                \draw[left hook->] (Uij) -- (Ui);
                \draw[right hook->] (Uij) -- (Uj);
                \draw[right hook->] (Ui) -- (U);
                \draw[left hook->] (Uj) -- (U);
            \end{tikzpicture}
            \xrightarrow{\ (1)\ }
            \begin{tikzpicture}[baseline=-1mm]
                \node (title) at (0, 2) {Matching family};
                \node (Uij) at (0, 1) {\footnotesize$x_i|_{U_i\cap U_j} = x_j|_{U_i\cap U_j}$};
                \node (Ui) at (-1, 0) {$x_i$};
                \node (Uj) at (1, 0) {$x_j$};
                \draw[->] (Uij) -- (Ui);
                \draw[->] (Uij) -- (Uj);
            \end{tikzpicture}
            \xrightarrow{\ (2)\ }
            \begin{tikzpicture}[baseline=-1mm]
                \node (title) at (0, 2) {Unique amalgamation};
                \node (Uij) at (0, 1) {\footnotesize$x_i|_{U_i\cap U_j} = x_j|_{U_i\cap U_j}$};
                \node (Ui) at (-1, 0) {\footnotesize$x_i=x|_{U_i}$};
                \node (Uj) at (1, 0) {\footnotesize$x_j=x|_{U_j}$};
                \node (U) at (0, -1) {$x$};
                \draw[->] (Uij) -- (Ui);
                \draw[->] (Uij) -- (Uj);
                \draw[->] (Ui) -- (U);
                \draw[->] (Uj) -- (U);
            \end{tikzpicture}
        \end{gather*}
        The descent condition then states that for every such matching family, there exists a unique element $x$ on $U$, such that the elements of the matching family are restrictions of $x$ as in step $(2)$ of the figure above.

        The classical example would be the assignment of the set of continuous functions to open subsets of a topological space. When two functions, defined on two open sets, coincide on the intersection, there exists a unique continuous function defined on the union, such that it restricts to the given functions.
    \end{example}

    Above, in \cref{topos:coverage}, the notion of a coverage was introduced. It should be clear that every coverage generates a sieve. Furthermore, although coverages are weaker and easier to handle, they are in fact equivalent for the purpose of sheaf theory.
    \begin{property}
        Consider a covering family $C$ and let $S_C$ be the sieve it generates. A presheaf is a sheaf for $C$ if and only if it is a sheaf for $S_C$.
    \end{property}

    \begin{example}[Canonical topology]\index{topology!canonical}
        The canonical topology on a category is the largest (finest) Grothendieck topology for which all representable presheaves are sheaves. A subcanonical topology is then defined as a subtopology of the canonical one, i.e.~any Grothendieck topology for which all representable presheaves are sheaves.
    \end{example}
    \begin{example}[Minimal and maximal topologies]
        The minimal Grothendieck topology on a category is the one for which only the maximal sieves are covering sieves. In this topology all presheaves are sheaves. The maximal Grothendieck topology is the one for which all sieves are covering sieves. In this topology only the terminal element of the associated presheaf category is a sheaf.
    \end{example}

    \newdef{Grothendieck topos}{\index{Grothendieck|seealso{topos}}\index{topos!Grothendieck}
        A category equivalent to the category of sheaves on a (small) site. This site is often called the \textbf{site of definition} for the given topos.
    }
    \begin{property}
        Every Grothendieck topos is an elementary topos.
    \end{property}

    \begin{property}
        For every Grothendieck topos there exists a site of definition for which the Grothendieck topology is (sub)canonical.
    \end{property}

    \begin{construct}[Sheafification]\index{sheafification}
        Given a presheaf $\mathcal{F}$, one can construct a sheaf $\overline{\mathcal{F}}$ along the same lines of \cref{sheaf:colimit_construction}.
    \end{construct}

    \newdef{Global sections functor}{\index{global!sections}\label{topos:global_sections}
        Every Grothendieck topos $\mathcal{E}$ admits a geometric morphism to $\mathbf{Set}$, where the right adjoint assigns to an object $x$ its set of global elements:
        \begin{gather}
            \Gamma:\mathcal{E}\rightarrow\mathbf{Set}:x\mapsto\mathcal{E}(1,x)\,.
        \end{gather}
        When $\mathcal{E}$ is the sheaf topos over a topological space, this is exactly the global sections functor (\cref{sheaf:global_sections_functor}). The left adjoint assigns to every set $S$ the copower $S\cdot1\equiv\bigsqcup_{s\in S}1$. When $\mathcal{E}$ is a sheaf topos, this adjoint is exactly the constant sheaf functor. It is sometimes denoted by $\mathrm{LConst}$.
    }

    A different approach for defining sheaf topoi is through an embedding of sheaves into presheaves.
    \newdef{Local isomorphism}{\index{local!isomorphism}
        A system of local isomorphisms in $\mathbf{Psh(C)}$ is a class of morphisms in $\mathbf{Psh(C)}$ forming a system of weak equivalences (\cref{model:weak_equivalence}) closed under pullbacks along morphisms out of representable presheaves.
    }
    \begin{property}[Local isomorphisms and Grothendieck topologies]
        A system of local isos induces a \textit{system of local epis} in the following way. $f:X\rightarrow Y$ is a local epi if $\im(f)\rightarrow Y$ is a local iso. A Grothendieck topology is defined by declaring a presheaf $F\in\mathbf{Psh(C)}$ to be a covering sieve at $X\in\ob{C}$ if $F\hookrightarrow\mathcal{Y}X$ is a local epi.
    \end{property}

    \newadef{Sheaf topos}{\index{topos!sheaf}\label{topos:topos_geometric_embedding}
        A category $\mathbf{Sh(C)}$ equipped with a geometric embedding into $\mathbf{Psh(C)}$.
        \begin{mdframed}[roundcorner=10pt, linecolor=blue, linewidth=1pt]
            \begin{proof}[Proof of equivalence]
            By \cref{topos:characterization_embedding} such a category is equivalent to the full subcategory on $S$-local presheaves for some system of local isomorphisms $S$ and, therefore, also to a sheaf topos in the sense of Grothendieck by the property above.\qed
            \end{proof}
        \end{mdframed}
    }
    \begin{remark}[Descent condition]
        This is essentially a restatement of the descent condition (cf.~\ref{topos:local_object_sheaf}). Covering sieves, regarded as subfunctors, are in particular local isomorphisms. Stability of sieves under pullback together with the co-Yoneda lemma~\ref{cat:ninja_yoneda}, which says that every presheaf is a colimit of representables, generates the full collection of local isomorphisms.
    \end{remark}

    By \cref{model:reflective_localization}, the construction of Grothendieck topoi as localizations of presheaf categories is equivalent to a definition in terms of reflections (this is due to \textit{Street}).
    \begin{result}
        Given a small category $\mathbf{C}$, there exists a bijection between the Grothendieck topologies on $\mathbf{C}$ and the equivalence classes of left exact reflective subcategories of $\mathbf{Psh(C)}$.
    \end{result}

    \newdef{Representable morphism}{\index{representable}
        A natural transformation of presheaves $F\rightarrow G$ is said to be representable if for every representable presheaf $h_X$ and every morphism $h_X\rightarrow G$ the pullback $h_X\times_GF$ is representable.
    }

    \begin{property}[Diagonals]\label{topos:representable_diagonal}
        The diagonal morphism $\Delta_F:F\rightarrow F\times F$, for $F$ a presheaf on a category with pullbacks, is representable if and only if any of the following two equivalent properties holds:
        \begin{enumerate}
            \item For every two representable presheaves $h_X,h_Y$ and natural transformations $h_X\rightarrow F,h_Y\rightarrow F$ the pullback $h_X\times_Fh_Y$ is representable.
            \item Every natural transformation $h_X\rightarrow F$ from a representable presheaf is representable.
        \end{enumerate}
    \end{property}

\subsection{Topological sheaves}

    See \cref{chapter:sheaf} for the application of sheaves to topology.

    \begin{property}[Presheaf topos]\label{topos:sheaf_topos}
        Consider the presheaf category \[\mathbf{Psh}(X):=\mathbf{Psh(Open}(X))\] over a topological space $(X,\tau)$. Unpacking \cref{topos:presheaf_topos} shows that this category is an elementary topos where the subobject classifier is given by
        \begin{gather}
            \Omega(U) = \{V\in\tau\mid V\subseteq U\}\,.
        \end{gather}
    \end{property}

    \begin{construct}[Sheaves and \'etal\'e bundles]\label{topos:etale_adjunction}
        Let $X$ be a topological space. The functor \[I:\mathbf{Open}(X)\rightarrow\mathbf{Top}_{/X}:U\mapsto(U\hookrightarrow X)\] induces the following adjunction:
        \begin{gather}
            \mathbf{Top}_{/X}\adj{E}{\Gamma}\mathbf{Psh}(X)\,.
        \end{gather}
        The slice category on the left-hand side is the category of (topological) bundles (see \cref{chapter:bundles}) over $X$. Both directions of the adjunction have a clear interpretation. The right adjoint assigns to every bundle its sheaf of local sections and the left adjoint assigns to every presheaf its bundle of germs.

        By restricting to the subcategories on which this adjunction becomes an adjoint equivalence, one obtains the \textbf{\'etal\'e space} and \textbf{sheaf categories} respectively:
        \begin{gather}
            \mathbf{Et}(X)\cong\mathbf{Sh}(X)\,.
        \end{gather}
        The category on the right-hand side is the category of sheaves on a topological space $X$. The category on the left is the full subcategory on local homeomorphisms, i.e.~the \'etal\'e spaces (\cref{topology:etale_space}).
    \end{construct}

    \begin{property}[Associated sheaf]
        The inclusion functor $\mathbf{Sh}(X)\hookrightarrow\mathbf{Psh}(X)$ admits a left adjoint, the \textbf{sheafification functor}, that assigns to every presheaf its associated sheaf. This functor is given by the composition $\Gamma\circ E$, which is simply \cref{sheaf:etale_construction}.

        The fact that the counit of the adjunction (\cref{topos:etale_adjunction}) restricts to an isomorphism on the full subcategory $\mathbf{Sh}(X)$ is equivalent to the fact that the sheafification of a sheaf $\Gamma$ is again $\Gamma$.
    \end{property}

    \newdef{Petit and gros topoi\footnotemark}{\index{topos!petit \& gros}\index{topos!spatial}
        \footnotetext{For those that do not master French, petit and gros mean small and big, respctively.}
        Consider a topological space $X$ together with its category of opens $\mathbf{Open}(X)$. The petit topos over $X$ is defined as the sheaf topos $\mathbf{Sh}(X)\equiv\mathbf{Sh}(\mathbf{Open}(X))$. It represents $X$ as a `generalized space'. (By \cref{topos:etale_adjunction} the objects in a petit topos are the \'etal\'e spaces over the given base space.) Topoi equivalent to such petit topoi are sometimes said to be \textbf{spatial}. However, one can also build a topos whose objects are themselves generalized spaces. To this end, choose a site $S$ of `probes' and call the sheaf topos $\mathbf{Sh}(S)$ a gros topos. (See \cref{section:smooth_spaces} for more information.)
    }

    \begin{property}[Localic reflection]\index{localic reflection}
        Mapping a topological space to its sheaf of continuous sections defines a functor $\func{\mathbf{Sh}}{Top}{Topos}$ by \cref{topos:topological_spaces}. When restricted to the full subcategory of sober spaces (\cref{topology:sober_space}), this functor becomes fully faithful. Generalizing to locales even gives a reflective inclusion (\cref{cat:reflective_inclusion}).

        This property states that no information is lost when regarding (sober) topological spaces as sheaf topoi. This also explains the name `petit topos'.
    \end{property}

    \newdef{Localic topos}{\index{localic!topos}
        Multiple equivalent definitions exist:
        \begin{enumerate}
            \item A topos equivalent to a sheaf topos over a locale (\cref{topology:locale}) equipped with the topology of jointly surjective morphisms.
            \item A topos generated under colimits of subobjects of the terminal object $1$.
            \item A topos $\mathcal{E}$ for which the global sections functor $\Gamma:\mathcal{E}\rightarrow\mathbf{Set}$ is localic, i.e.~every object in $\mathcal{E}$ is a subquotient of an object in the inverse image $\Gamma^*$
        \end{enumerate}
        Given a geometric morphism to some base topos $\mathcal{S}$, one can define $\mathcal{S}$-localic topoi by generalizing the third point.
    }
    The following property shows that the locale in the first definition has a specific meaning.
    \begin{property}
        By \cref{topos:heyting_algebra}, for every topos the poset $\mathrm{Sub}(1)$ is a locale. Every localic topos $\mathcal{E}$ satisfies $\mathcal{E}\cong\mathrm{Sh}\big(\mathrm{Sub}(1)\big)$, where $\mathrm{Sub}(1)$ is equipped with the topology of jointly surjective morphisms.
    \end{property}

    The equivalence between localic topoi and locales carries over to the notion of $\mathcal{S}$-localic topoi.
    \begin{property}
        The (2-)category of localic topoi over a base topos $\mathcal{S}$ is equivalent to the (2-)category $\mathbf{Loc}(\mathcal{S})$ of locales internal to $\mathcal{S}$.
    \end{property}
    \begin{property}\label{topos:slice_locale}
        Given a locale $X$, the category $\mathbf{Loc}\big(\mathbf{Sh}(X)\big)$ is equivalent to the slice category $\mathbf{Loc}_{/X}$.
    \end{property}

\subsection{Lawvere--Tierney topology}

    \newdef{Lawvere--Tierney topology}{\index{Lawvere--Tierney}
        As noted in \cref{section:internal_logic} on the internal logic of elementary topoi, the subobject classifier $\Omega$ has the structure of an internal Heyting algebra and, in particular, that of a (bounded) meet-semilattice. This internal poset, viewed as an internal category, admits the construction of a closure operator $j:\Omega\rightarrow\Omega$ (\cref{cat:closure_operator}) satisfying the following condition:
        \begin{gather}
            j\circ\land = \land\circ(j\times j)\,.
        \end{gather}
        This condition states (in a nontrivial way) that $j$ is (internally) order-preserving. More concisely, a Lawvere--Tierney topology is internally a left exact modality on $\Omega$.
    }
    \begin{remark}
        The condition satisfied by the unit morphism in the definition of a closure operator can also be reformulated in this context as follows:
        \begin{gather}
            j\circ\texttt{true} = \texttt{true}\,.
        \end{gather}
    \end{remark}
    The Lawvere--Tierney operator also induces a `closure operator' on all posets $\mathrm{Sub}(x)$ in the topos. Given an object $x$ and a subobject $u\in\text{Sub}(x)$, one defines the closure $j_\ast(u)\in\text{Sub}(x)$ as the subobject classified by the characteristic morphism $j\circ\chi_u:x\rightarrow\Omega$.

    \newdef{Dense object}{\index{dense}
        Given a Lawvere--Tierney topology $j:\Omega\rightarrow\Omega$, a subobject $u\in\text{Sub}(x)$ is said to be dense (in $x$) if it satisfies $j_\ast(u)=x$.
    }
    \newadef{Sheaf}{\index{sheaf}
        Given a Lawvere--Tierney topology $j:\Omega\rightarrow\Omega$ on a topos $\mathcal{E}$, one calls an object $s\in\ob{\mathcal{E}}$ a $j$-sheaf if for all dense morphisms $u\hookrightarrow x$ the induced map \[\mathcal{E}(x,s)\rightarrow\mathcal{E}(u,s)\] is a bijection.
    }

    \begin{property}
        Lawvere--Tierney topologies on $\mathcal{E}$ are in correspondence with subtopoi of $\mathcal{E}$.
    \end{property}
    In the case of (pre)sheaf topoi, Lawvere--Tierney topologies recover Grothendieck topologies.
    \begin{result}
        For the presheaf topos on a small category $\mathbf{C}$, the Grothendieck topologies on $\mathbf{C}$ are equivalent to Lawvere--Tierney topologies on $\mathbf{Psh(C)}$.
        \begin{mdframed}[roundcorner=10pt, linecolor=blue, linewidth=1pt]
            \begin{proof}[Sketch of proof]
                Since a Grothendieck topology assigns to every object a collection of sieves, \cref{topos:presheaf_topos} implies that $J(x)\subseteq\Omega_\mathbf{Psh}(x)$ for all $x\in\ob{C}$. By the base change condition of Grothendieck topologies, this relation is natural in $x$ and, hence, $J$ is a subobject of $\Omega_\mathbf{Psh}$. One thus finds a characteristic morphism $j:\Omega_\mathbf{Psh}\rightarrow\Omega_\mathbf{Psh}$ that can be proven (by the other conditions of Grothendieck topologies) to define a Lawvere--Tierney topology on $\mathbf{Psh(C)}$. Conversely, a Lawvere--Tierney topology is a morphism $j:\Omega\rightarrow\Omega$ and, hence, determines a unique subobject of $\Omega_\mathbf{Psh}$, i.e.~a unique collection of sieves for every object $x\in\ob{C}$. From the conditions of Lawvere--Tierney topologies one can then prove that this collection satisfies the conditions of a Grothendieck topology.
            \end{proof}
        \end{mdframed}
    \end{result}

\section{Stacks}\index{stack}
\subsection{2-sheafs}

    An important subject, especially in the context of gauge theories in physics, is that of groupoid-valued (pre)sheaves. To this end, sites are generalized to higher category theory.
    \newdef{2-presheaf}{\index{presheaf}\index{prestack}
        Consider a 2-category $\mathbf{C}$. A 2-presheaf on $\mathbf{C}$ is a pseudofunctor $\cfunc{F}{C}{Cat}$. When $\mathbf{C}$ is the categorification of a 1-category, i.e.~when it has discrete hom-categories, 2-presheaves are better known as \textbf{prestacks}.
    }
    \newdef{2-coverage}{\index{coverage}\index{site}
        Virtually the same as an ordinary coverage (\cref{topos:coverage}), but factorization is only required to exist up to an isomorphism. A 2-category equipped with a 2-coverage is called a \textbf{2-site}.

        As for 1-sites, every coverage generates a unique sieve. It is the full subcategory on those morphisms that factor through a covering map in the given coverage (again up to isomorphism).
    }
    As in the case of ordinary categories (\cref{topos:local_object_sheaf}), one can define 2-sheaves through a descent condition.
    \newdef{2-sheaf}{\label{topos:2_sheaf}
        A 2-presheaf $\cfunc{F}{C}{Cat}$ on a 2-site $(\mathbf{C},J)$ is said to be a 2-sheaf with respect to $J$ if for all sieves $S\in J$ the following functor is an equivalence:
        \begin{gather}
            Fc\cong\mathbf{Psh}_2(\mathcal{Y}c,F)\rightarrow\mathbf{Psh}_2(S,F)\,,
        \end{gather}
        where the fist equivalence is just the 2-Yoneda lemma.
    }
    \begin{remark}
        It should be noted that 2-(pre)sheaves can also be defined on ordinary (1-)sites. Sieves, regarded as subfunctors of the Yoneda embedding, take values in $\mathbf{Set}$. By composing these with the embedding $\mathbf{Set}\hookrightarrow\mathbf{Cat}$ of sets as (discrete) categories, one obtains 2-subfunctors of the 2-Yoneda embedding. Often 2-sheaves over 1-sites are called \textbf{stacks} (although this terminology is also used for general 2-sites).
    \end{remark}

    \newdef{Prestack of groupoids}{
        Consider a category $\mathbf{C}$. A prestack of groupoids on $\mathbf{C}$ is a $\mathbf{Grpd}$-valued prestack on $\mathbf{C}$.

        The category of (groupoid-valued) prestacks becomes $\mathbf{Grpd}$-enriched if one takes the hom-category between two prestacks $F,G$ to consist of the following data:
        \begin{itemize}
            \item\textbf{Objects}: The natural transformations $\alpha:F\Rightarrow G$ (note that the components are themselves functors).
            \item\textbf{Morphisms}: The ``strict modifications'' in the sense that they map objects in $\mathbf{C}$ to natural transformations satisfying the whiskering condition (see also Definition \ref{cat:modification})
            \begin{gather}
                \mathbbm{1}_{Ff}\cdot\mathfrak{m}_b = \mathfrak{m}_a\cdot\mathbbm{1}_{Gf}\,.
            \end{gather}
        \end{itemize}
    }

    For ordinary sites and presheaves, descent was defined in terms of matching families. Since presheaves are now taking values in a 2-category, the matching families are a bit more complex. However, this structure is already familiar from differential geometry and algebraic topology, where it is known under the name of the \textit{\v{C}ech nerve}.
    \newdef{\v{C}ech groupoid}{\index{Cech!groupoid}
        Consider a site $(\mathbf{C},J)$. To every covering family $\mathcal{U}\equiv\{f_i:x_i\rightarrow x\}_{i\in I}$ one can assign an internal groupoid in presheaves $C(\mathcal{U})$ consisting of the following data:
        \begin{itemize}
            \item\textbf{Objects}: $\bigsqcup_i\mathcal{Y}x_i$, and
            \item\textbf{Morphisms}: $\bigsqcup_{i,j}\mathcal{Y}x_i\times_{\mathcal{Y}x}\mathcal{Y}x_j$.
        \end{itemize}
        This is equivalent to the ($\mathbf{Grpd}$-valued) presheaf that assigns to every object $y\in\ob{C}$ the groupoid consisting of the following data:
        \begin{itemize}
            \item\textbf{Objects}: The pairs $(i,g_i:y\rightarrow x_i)$ where $x_i\in\mathcal{U}$, and
            \item\textbf{Morphisms}: A unique arrow $(i,g_i)\rightarrow(j,g_j)$ if and only if $f_i\circ g_i = f_j\circ g_j$.
        \end{itemize}
    }
    Comparing the definition of morphisms in the \v{C}ech groupoid to the condition for matching families in \cref{topos:matching_family}, shows that one could presume that the \v{C}ech groupoid is related to the matching families. This intuition is indeed correct:
    \begin{property}[Matching families]\label{topos:cech_matching_families}
        Any ordinary presheaf $F$ can be considered to be $\mathbf{Grpd}$-valued by postcomposing with the embedding $\mathbf{Set}\hookrightarrow\mathbf{Grpd}$. For any covering family $\mathcal{U}$, there exists an isomorphism
        \begin{gather}
            \cfunccat{C}{Grpd}(C(\mathcal{U}),F)\cong\mathbf{Psh}_2(\mathcal{U},F)\,.
        \end{gather}
        Because the \v{C}ech groupoid (co)represents a descent object, it is sometimes called a \textbf{codescent object}.
    \end{property}
    It is exactly this (co)descent property of the \v{C}ech groupoid that will be used in \cref{chapter:hdg} to define (higher) smooth groupoids.

    People with some experience in algebraic topology will also notice that the \v{C}ech groupoid only contains the first degrees of the \v{C}ech complex. The full \v{C}ech complex can be obtained from the following construction.
    \newdef{\v{C}ech nerve}{\index{Cech!nerve}
        Consider a morphism $f:y\rightarrow x$ in a category $\mathbf{C}$. The \v{C}ech nerve $C_\bullet(f)$ is the simplicial object \ref{model:simplicial_object} that is defined as the $(k+1)$-fold pullback of $f$ along itself in degree $k$. For a covering family $\mathcal{U}\equiv\{f_i:x_i\rightarrow x\}$, the \v{C}ech nerve is defined as $C_\bullet(\mathcal{U}):=C_\bullet(\bigsqcup_ix_i\rightarrow x)$.
    }
    For $\infty$-sheaves the full \v{C}ech nerve will be used. However, for 2-sheaves and, in particular, stacks, only its 3-coskeleton is necessary. The extra information will encode the \textit{cocycle condition}~\eqref{bundle:G_cocycle_condition} from the study of fibre bundles.

\subsection{Stacks on a 1-site}

    For the definition of stacks, one needs the notions of fibred categories or, equivalently, pseudofunctors as defined in \cref{section:fibred_categories}. The definitions are recalled here.
    \begin{mdframed}[roundcorner=10pt, linecolor=green, linewidth=1pt]
        Consider a functor $\func{\Pi}{A}{B}$. A morphism $f$ in $\mathbf{A}$ is said to be $\Pi$-Cartesian if for every morphism $\varphi$ in $\mathbf{A}$ and factorization of $\Pi\varphi$ through $\Pi f$ in $\mathbf{B}$, there exists a unique factorization of $\varphi$ through $f$. $f$ is called the inverse image of $\Pi f$.

        A fibred category consists of a functor $\func{\Pi}{A}{B}$ such that for each morphism in $(f:c\rightarrow d)\mathbf{B}$ with $d\in\im(\Pi)$ and each lift $y\in\mathbf{A}_d$ there exists at least one inverse image in $(\widetilde{f}:x\rightarrow y)\in\mathbf{A}$ of $f$. By the Grothendieck construction every fibred category gives rise to a pseudofunctor $\cfunc{F}{B}{Cat}$ by sending objects to their fibres under $\Pi$ and sending morphisms $f$ to their pullback functors $f^*$.
    \end{mdframed}

    \newdef{Descent datum}{\index{descent}
        Consider a category $\mathbf{C}$ with a covering family $\mathcal{U}\equiv\{f_i:x_i\rightarrow x\}$ and a pseudofunctor $\cfunc{F}{C}{Cat}$. The projections associated to the pullback $x_i\cap x_j:=x_i\times_xx_j$ will be denoted by $\pi_i$ and $\pi_j$ (and analogously for iterated pullbacks). A descent datum for $\mathcal{U}$ with respect to $F$ is a pair of families $(\{g_i\},\{f_{ij}\})_{i,j\in I}$, where $\{g_i\}$ is a matching family for $\mathcal{U}$ with respect to $F$ and every $f_{ij}$ is an isomorphism $\pi_i^*x_i\cong \pi_j^*x_j$. This data is required to satisify the following \textbf{cocycle condition}:
        \begin{gather}
            \pi_{ik}^*f_{ik} = \pi_{ij}^*f_{ij}\circ\pi_{jk}^*f_{jk}\,.
        \end{gather}
        Morphisms $(\{g_i\},\{f_{ij}\})\rightarrow(\{g'_i\},\{f'_{ij}\})$ between descent data are families of morphisms $\{\phi_i:g_i\rightarrow g'_i\}$ that satisfy
        \begin{gather}
            \pi_i^*\phi_i\circ f_{ij} = f'_{ij}\circ\pi_j^*\phi_j\,.
        \end{gather}
        The category of descent data for $\mathcal{U}$ with respect to $F$ will be denoted by $\mathrm{Descent}(\mathcal{U},F)$.
    }
    \begin{construct}
        Consider an object $\xi$ in $Fx$. From this object one can construct a descent datum as follows. The objects $g_i$ are the pullbacks $f_i^*\xi$ and the isomorphisms $f_{ij}:\pi_i^*f_i^*\xi\cong\pi_j^*f_j^*\xi$ are obtained from the fact that both these objects are (Cartesian) pullbacks of the same morphisms. Arrows in $Fx$ induce morphisms of descent data by (Cartesian) pullbacks along the covering maps. This construction defines a functor $Fx\rightarrow\mathrm{Descent}(\mathcal{U},F)$. It can be shown that this construction is independent of a choice of cleavage up to equivalence.
    \end{construct}

    \newdef{Stack}{\index{prestack}\index{stack}
        Consider a fibred category $F$ over a site $(\mathbf{C},J)$.
        \begin{itemize}
            \item $F$ is called a \textbf{separated prestack} if for each covering family $\mathcal{U}$ on $x\in\ob{C}$, the functor $Fx\rightarrow\mathrm{Descent}(\mathcal{U},F)$ is fully faithful.
            \item $F$ is called a \textbf{stack} if for each covering family $\mathcal{U}$ on $x\in\ob{C}$ the functor $Fx\rightarrow\mathrm{Descent}(\mathcal{U},F)$ is an equivalence.
        \end{itemize}
        This is a generalization of the descent condition~\ref{topos:local_object_sheaf}. This can be seen by observing that $\mathrm{Descent}(\mathcal{U},F)\cong\mathbf{Psh}_2(S(\mathcal{U}),F)$, where $S(\mathcal{U})$ is the sieve generated by $\mathcal{U}$ regarded as a fibred category. When $F$ is fibred over groupoids, it is called a \textbf{stack of groupoids}. This forms the category $\mathbf{Sh}_{(2,1)}(\mathbf{C})$ of $(2,1)$-sheaves. In fact, it is this subcategory that is usually meant when considering stacks.
    }

    A more conceptual (although completely equivalent) generalization from (1-)sheaves to 2-sheaves can be obtained by starting from \cref{topos:cech_matching_families}. There it was shown that matching families for (1-)presheaves can be obtained as natural transformations from the \v{C}ech groupoid.
    \begin{property}[Descent data and \v{C}ech nerve]
        Let $C(\mathcal{U})$ denote the 3-coskeleton of the \v{C}ech nerve $C_\bullet(\mathcal{U})$. Pseudonatural transformations $C(\mathcal{U})\Rightarrow F$ can be shown to be equivalent to tuples $(c,\{c_i\},\{c_{ij}\},\{c_{ijk}\})$, where $c_i\in Fx_i$, that fit into cubes lying in the image of $C_2(\mathcal{U})$ in which all edges consist of Cartesian morphisms. Arrows between such cubes are given by arrows between the vertices that make the ``obvious'' diagrams commute.

        By comparing these cubes to the previous definition of descent data, one obtains the following equivalence:
        \begin{gather}
            \mathrm{Descent}(\mathcal{U},F)\cong\cfunccat{C}{Cat}\bigl(C(\mathcal{U}),F\bigr)\,.
        \end{gather}
        ?? FINISH THIS ??
    \end{property}

    \begin{remark}[1-sheaves]
        Although most of the above seems very abstract and complex compared to ordinary sheaves, it is not quite so. In fact, when restricting to pseudofunctors of the form $\mathbf{C}^{op}\rightarrow\mathbf{Set}$, where the embedding $\mathbf{Set}\hookrightarrow\mathbf{Cat}$ sends sets to discrete categories, one obtains ordinary sheaves as a subcategory of stacks. For example, by the equivalence between pseudofunctors and Grothendieck fibrations, it is known that the Cartesian pullbacks $f^*$ are in fact just the images of morphism $f$ under the pseudofunctor $F$. This way the condition $\pi_1^*c_i\cong\pi^*_2c_j$ can be rewritten as $Ff'_i(c_i)=Ff'_j(c_j)$, which is nothing but the matching family condition~\eqref{topos:matching_family_condition}.
    \end{remark}

\section{Higher topos theory}

    In this section the notion of topos is generalized from ordinary category theory to higher category theory. In particular, $\infty$-sheaves will be defined. This will require a suitable foundation for $\infty$-category theory. To this end the language of (simplicial) model categories as introduced in \cref{chapter:model_theory} will be used.

    \newdef{\texorpdfstring{$\infty$-groupoid}{Infinity-groupoid}}{\index{groupoid}\label{topos:infty_groupoid}
        Objects of the full simplicial subcategory of $\mathbf{sSet}_\text{Quillen}$ on Kan complexes. From \cref{model:horn_filler}, it is immediately clear how this generalizes the definition of ordinary groupoids. For groupoids one needs unique horn fillers (composition in ordinary categories is unique), while for $\infty$-groupoids this is allowed to be unique up to higher coherence.
    }
    \newdef{\texorpdfstring{$(\infty,1)$-category}{(Infinity,1)-category}}{\index{category}
        An $\infty\mathbf{Grpd}$-enriched category or, equivalently, a simplicially enriched category for which all hom-objects are Kan complexes. The functor category between $(\infty,1)$-categories is defined through the (simplicial) nerve and realization functors (\cref{model:nerve}):
        \begin{gather}
            \funccat{C}{D} := |\mathbf{sSet}(N\mathbf{C},N\mathbf{D})|\,.
        \end{gather}
    }

    \begin{property}[\v{C}ech model structure]\label{topos:cech_model_structure}
        For any small category $\mathbf{C}$, the $\infty$-category of $\infty\mathbf{Grpd}$-valued $\infty$-sheaves can be represented by the category $[\mathbf{C}^{op},\mathbf{sSet}]$ of simplicial presheaves on $\mathbf{C}$ by a theorem of \textit{Lurie} (\cref{model:lurie_presentation}), i.e.~there exists an $\infty$-equivalence between $\mathbf{Sh}_{(\infty,1)}(\mathbf{C})$ and the full subcategory on fibrant-cofibrant objects of the (left Bousfield) localization of $[\mathbf{C}^{op},\mathbf{sSet}]$ at the \v{C}ech nerve projections. The resulting model structure is called the \textbf{\v{C}ech model structure}.

        A presheaf $X$ is fibrant in this model structure if the map
        \begin{gather}
            \hom(M,X)\rightarrow\hom\bigl(\mathcal{C}(\mathcal{U}),X\bigr)
        \end{gather}
        is a weak equivalence for all open covers $\mathcal{U}$, i.e.~exactly if $X$ satisfies the descent condition and, hence, is an $\infty$-stack.
    \end{property}

    The most straightforward definition of an $\infty$-sheaf generalizes \cref{topos:local_object_sheaf}.
    \newdef{\texorpdfstring{$\infty$-sheaf}{Infinity-sheaf}}{\index{sheaf}
        Consider an $\infty$-site $(\mathbf{C},J)$ and let $S$ denote the collection of monomorphisms in $\mathbf{Psh}_\infty(\mathbf{C})$ induced by the covering sieves. An $\infty$-presheaf on $\mathbf{C}$ is called a $J$-sheaf if it is $S$-local. A presheaf with values in an $\infty$-category $\mathbf{D}$ is called a sheaf if the representable presheaf $\mathbf{D}(x,F-)$ is a $J$-sheaf for all $x\in\ob{D}$.

        In terms of the \v{C}ech nerve $\mathcal{C}$, the descent condition can be written as follows:
        \begin{gather}
            Fx\simeq\mathbf{Psh}_\infty(\mathcal{C}(\mathcal{U}),F)
        \end{gather}
        for all covers $\mathcal{U}$ of $x$, where $\simeq$ denotes a weak equivalence.
    }
    \newdef{\texorpdfstring{$\infty$-stack}{Infinity-stack}}{\index{stack}
        An $(\infty,1)$-sheaf taking values in $\infty\mathbf{Grpd}$.
    }

    \Cref{topos:global_sections} can be generalized as follows.
    \begin{property}
        For every $\infty$-topos $\mathbf{H}$ there exists a geometric morphism $(\mathrm{Disc}\dashv\Gamma):\mathbf{H}\leftrightarrows\infty\mathbf{Grpd}$. Any morphism into a discrete object $\mathrm{Disc}(X)$ is constant.

        The left adjoint is sometimes called the \textbf{discrete object functor}. This terminology stems from the case of the forgetful functor $\func{\Gamma}{Top}{Set}$, where the (fully faithful) left adjoint equips a set with the discrete topology.
    \end{property}
    \begin{example}[Sheaves on manifolds]
        One of the archetypal examples of $\infty$-topoi is the topos of sheaves over smooth manifolds. By the Yoneda embedding one can regard a manifold as a sheaf and the global sections functor maps this representable sheaf to the manifold itself: $\Gamma(M)=M$. For a Lie group one can construct the classifying stack $\mathbf{B}G$. The global sections functor maps this stack to the delooping groupoid $BG$.
    \end{example}

    \newdef{Mapping stack}{\label{topos:mapping_stack}
        Consider two $\infty$-stacks $X,Y\in\mathbf{Sh}_{(\infty,1)}(\mathbf{C})$. The mapping stack is defined as follows:
        \begin{gather}
            [X,Y](U):=\mathbf{Sh}_{(\infty,1)}(\mathbf{C})(X\times U,Y)\,,
        \end{gather}
        where on the right-hand side, $U$ denotes the representable $\infty$-stack.
    }

    ?? FINISH (PERHAPS MOVE infinity-CATEGORY STUFF TO CHAPTER ON MODEL THEORY) ??

\section{Cohomology}\index{cohomology}

    In this section, cohomology will be generalized to the $\infty$-categorical setting.

    First, take a topological space $X$ and an $\infty$-groupoid $G$. Geometric realization (\cref{model:geometric_realization}) gives an equivalence $\infty\mathbf{Grpd}\cong\mathbf{Top}$ and, therefore, one can define the intrinsic cohomology of $X$ with coefficients in $G$ as follows:
    \begin{gather}
        H(X;G) := \pi_0\mathbf{Top}(X,|G|)\,.
    \end{gather}
    $X$ can also be identified with its petit ($\infty$-)topos $\mathbf{Sh}_{(\infty,1)}(X)$, in which $X$ sits as the terminal object. From this point of view the intrinsic cohomology of $X$ with coefficients in $G$ is
    \begin{gather}
        \overline{H}(X;G) := \pi_0\mathbf{Sh}_{(\infty,1)}(X)(X,\mathrm{LConst}\,G)\cong\pi_0\circ\Gamma\circ\mathrm{LConst}(G)\,.
    \end{gather}
    This is the \textbf{cohomology with constant coefficients} of $X$ with coefficients in $G$. If $X$ is paracompact, the two cohomologies coincide: $H(X;G)\cong\overline{H}(X;G)$.

    Now, it is time to pass to general cohomology.
    \newdef{Intrinsic cohomology}{\index{cohomology}\label{topos:cohomology}
        Consider a $(\infty,1)$-category $\mathbf{H}$. For every two objects $X,A\in\mathbf{H}$, the hom-space $\mathbf{H}(X,A)$ is an $\infty$-groupoid. Define the following notions:
        \begin{itemize}
            \item The objects in $\mathbf{H}(X,A)$ are called \textbf{cocycles}.
            \item The morphism in $\mathbf{H}(X,A)$ are called \textbf{coboundaries}.
            \item The set of connected components
            \begin{gather}
                H(X;A):=\pi_0\mathbf{H}(X,A)=\hom_\mathbf{Ho(H)}(X,A)\,,
            \end{gather}
            where $\mathbf{Ho(H)}$ is the homotopy category \ref{model:homotopy_category_2} of $\mathbf{H}$, is called the intrinsic cohomology of $X$ with coefficients in $A$.
        \end{itemize}
        If the object $A$ admits an $n$-delooping $\mathbf{B}^nA$, the $n^{th}$ cohomology group of $X$ is defined as
        \begin{gather}
            H^n(X;A):=H(X;\mathbf{B}^nA)\,.
        \end{gather}
    }

    \begin{example}[Singular cohomology]
        Consider a topological space $X$. For every group $G$ one can define the first delooping (\cref{cat:group_delooping}), so one can also define the zeroth and first cohomology groups $H^{0,1}(X;G)$. Only when $G$ is Abelian do higher deloopings exists (in fact, if $G$ is Abelian all higher deloopings exist), and so in this case higher cohomology groups $H^{\geq 2}(X;G)$ can be defined. It can be shown that these coincide with the singular cohomology groups of $X$.
    \end{example}

    \begin{example}[Group cohomology]
        Consider a (discrete) group $G$ together with its delooping groupoid $\mathbf{B}G$. The group cohomology (\cref{group:cohomology}) of a group with coefficients in an Abelian group $A$ is given by the intrinsic cohomology of $\infty\mathbf{Grpd}$ of the delooping groupoids:
        \begin{gather}
            H(G;A)\cong\pi_0\infty\mathbf{Grpd}(\mathbf{B}G,\mathbf{B}A)\,.
        \end{gather}
    \end{example}

    By replacing the topos $\mathbf{H}$ by a slice topos $\mathbf{H}_{/X}$ one obtains twisted cohomology.
    \newdef{Twisted cohomology}{\index{cohomology!twisted}
        Consider a $(\infty,1)$-topos $\mathbf{H}$ with some object $X\in\ob{H}$. The mapping space $\mathbf{H}(X,A)$, the cocycles of $X$ with coefficients in $A$, is easily seen to be isomorphic to the mapping space $\mathbf{H}_{/X}(X,X\times A)$, where the second argument is equipped with the canonical projection morphism. Morphisms in this space are just sections of the trivial $A$-$\infty$-bundle over $X$. General twisted cohomology can then be defined as the space of sections of an arbitrary $A$-$\infty$-bundle over $X$.

        By passing to classifying morphisms of bundles one obtains the twist $\chi:X\rightarrow\mathbf{BAut}(A)$ and the universal bundle $\rho_A:A/\!\!/\mathbf{Aut}(A)\rightarrow\mathbf{BAut}(A)$. $\chi$-twisted cohomology is then given by (hte connected components of) the following mapping space:
        \begin{gather}
            \mathbf{H}_{/\mathbf{BAut}(A)}(\chi,\rho_A)\,.
        \end{gather}
    }
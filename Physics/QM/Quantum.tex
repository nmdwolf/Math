\chapter{Quantum Mechanics}

    The main reference for this chapter is~\citet{bransden_quantum_2000}. In the first two sections the two basic formalisms of Quantum Mechanics are introduced: wave and matrix mechanics. The main reference for the mathematically rigorous treatment of quantum mechanics, in particular in the infinite-dimensional setting, is~\citet{moretti_mathematical_2016}. The main reference for the generalization to curved backgrounds is~\citet{schuller_lectures_2016}. Relevant chapters in this compendium are \ref{chapter:distributions}, \ref{chapter:functional} and \ref{chapter:operator_algebras}.

\section{Schr\"odinger picture}

    \begin{formula}[Time-independent Schr\"odinger equation]\index{Schr\"odinger!equation}\index{Hamilton!function}\label{wavematrix:TISE}
        \nomenclature[A_TISE]{TISE}{time-independent Schr\"odinger equation}
        \begin{gather}
            \hat{H}\psi(x) = E\psi(x)
        \end{gather}
        The operator $\hat{H}$ is called the \textbf{Hamiltonian} of the system. The wave function $\psi$ is an element of the vector space $L^2(\mathbb{R},\mathbb{C})\otimes\mathcal{H}$ with $\mathcal{H}$ the internal Hilbert space (describing for example the spin or charge of a particle). This is an eigenvalue equation for the energy levels of the system.
    \end{formula}

    \newprop{Orthogonality}{
        Let $\{\psi_i\}_{i\in I}\subset L^2(\mathbb{R})$ be a collection of eigenfunctions of the TISE (the internal space is supressed for convenience). These functions can be normalized with respect to the inner product~\eqref{lebesgue:L2_inner_product} such that they obey the following relation:
        \begin{gather}
            \label{wavematrix:orthogonality}
            \Int_{\mathbb{R}}\overline{\psi_i}(x)\psi_j(x)\,dx = \delta_{ij}\,.
        \end{gather}
    }

    The time evolution of a wave function is defined through the following equation.
    \newformula{TDSE}{\index{Schr\"odinger!equation}\label{wavematrix:TDSE}
        \nomenclature[A_TDSE]{TDSE}{time-dependent Schr\"odinger equation}
        The following partial differential equation is called the \textbf{(time-dependent) Schr\"odinger equation}:
        \begin{gather}
            i\hbar\pderiv{}{t}\psi(x,t) = \hat{H}\psi(x,t)\,.
        \end{gather}
        In case $\hat{H}$ is time-independent, the TISE can be obtained from this equation by separation of variables (see below).
    }

    \begin{example}[Massive particle in a stationary potential]
        \begin{gather}
            \label{wavematrix:TDSE_position}
            i\hbar\pderiv{}{t}\psi(x,t) = \left(\frac{\hat{p}^2}{2m} + \hat{V}(x)\right)\psi(x,t)
        \end{gather}
        \begin{mdframed}[roundcorner=10pt, linecolor=blue, linewidth=1pt]
            \begin{proof}[Derivation of TISE from TDSE]
                Starting from the one-dimensional TDSE in position space with a time-independent potential
                \begin{gather}
               		i\hbar\pderiv{}{t}\Psi(x,t) = \left(-\frac{\hbar^2}{2m}\partial_x^{\ 2} + V(x)\right)\Psi(x,t)\,,
               	\end{gather}
                one can perform a separation of variables and assert a solution of the form $\Psi(x,t) = \psi(x)T(t)$. Inserting this in the previous equation gives
                \begin{gather}
               		i\hbar\psi(x)T'(t) = -\frac{\hbar^2}{2m}T(t)\psi''(x) + V(x)\psi(x)T(t)\,.
               	\end{gather}
                Dividing both sides by $X(x)T(t)$ and rearranging the terms gives
                \begin{gather}
               		i\hbar\frac{T'(t)}{T(t)} = \left(-\frac{\hbar^2}{2m} + V(x)\right)\frac{\psi''(x)}{\psi(x)}\,.
               	\end{gather}
                Because the left side only depends on $t$ and the right side only depends on $x$, one can conclude that they are both equal to a constant $E$. This leads to the following system of differential equations:
                \begin{gather}
                    \begin{cases}
                        i\hbar T'(t) - ET(t) = 0\,,\\
                        \left(-\frac{\hbar^2}{2m} + V(x)\right)\psi''(x) = E\psi(x)\,.
                    \end{cases}
                \end{gather}
                The first equation immediately gives a solution for $T$:
                \begin{gather}
                    \label{derivations_qm:exponential}
               		T(t) = Ce^{-\frac{i}{\hbar}Et}\,.
               	\end{gather}
                Rearranging the second solution in the system gives the TISE:
                \begin{gather}
                    \label{derivations_qm:TISE}
               		\psi''(x) = -\frac{2m}{\hbar^2}\bigl(E - V(x)\bigr)\psi(x)\,.
               	\end{gather}
            \end{proof}
        \end{mdframed}
    \end{example}

    \begin{formula}[General solution]
        A general solution of the time-dependent Schr\"odinger equation (for time-independent Hamiltonians) is given by the following formula (cf.~\cref{ode:first_order_general_solution}):
        \begin{gather}
            \label{wavematrix:general_solution}
            \psi(x,t) = \sum_Ec_E\psi_E(x)e^{-\frac{i}{\hbar}Et}\,,
        \end{gather}
        where the functions $\psi_E(x)$ are the eigenfunctions of the TISE (\cref{wavematrix:TISE}). The coefficients $c_E$ can be found using the orthogonality relations
        \begin{gather}
            \label{wavematrix:general_solution_coefficients}
            c_E=\left(\Int_{\mathbb{R}}\overline{\psi_E}(x)\psi(x,t_0)\,dx\right)e^{\frac{i}{\hbar}Et_0}\,.
        \end{gather}
    \end{formula}

    ?? COMPLETE ??

\subsection{Hydrogen atom}

    Consider the hydrigen atom, i.e.~a single proton (the nucleus) orbited by a single electron with only the electrostatic Coulomb force acting between them (gravity can safely be neglected):
    \begin{gather}
        \hat{H} := \frac{\hat{p}_p^2}{2m_p} + \frac{\hat{p}_e^2}{2m_e} - \frac{e^2}{4\pi\varepsilon r^2}\,.
    \end{gather}
    It is not hard to see that this is the quantum mechanical version of the Kepler problem (\cref{section:kepler}). The special property of the Kepler problem was that it contained a `hidden' symmetry that gave rise to the conserved Laplace--Runge--Lenz vector (\cref{classic:lrl_vector}). As is the case for all conserved charges in quantum mechanics, this symmetry induces a degeneracy of the energy eigenvalues. Degeneracy of the magnetic quantum number $m$ follows from rotational symmetry, but the energy levels of the hydrogen atom only depend on the principal quantum number $n$. The degeneracy of the total angular quantum number $l$ is that due to the `hidden' $\mathrm{SO}(4)$-symmetry. It is often called an `accidental degeneracy' for this reason.

    ?? COMPLETE ??

\subsection{Molecular dynamics}

    Consider the Hamiltonian of two interacting atoms:
    \begin{gather}
        \hat{H} = \frac{\hat{P}_1^2}{2M_1} + \frac{\hat{P}_2^2}{2M_2} + \frac{q_1q_2}{4\pi\varepsilon R^2} + \sum_i\frac{\hat{p}_i^2}{2m} - \frac{eq_1}{4\pi\varepsilon r_{i1}^2} - \frac{eq_2}{4\pi\varepsilon r_{i2}^2} + \sum_{i\neq j}\frac{e^2}{4\pi\varepsilon r_{ij}^2}\,,
    \end{gather}
    where the indices $i,j$ indicate the electrons and capital symbols denote operators associated to the nuclei.

    Except for the most simple situations, solving the Schr\"odinger equation for this Hamiltonian becomes intractable (both analytically and numerically). However, in general, one can approximate the situation. The mass of nuclei are much larger than those of the electrons and this influences their motion, they move much slower than the electrons. In essence, the nuclei and electrons live on different time scales and this allows to decouple their dynamics:
    \begin{gather}
        \hat{H}_{\text{nucl}} = \frac{\hat{P}_1^2}{2M_1} + \frac{\hat{P}_2^2}{2M_2} + \frac{Q_1Q_2}{4\pi\varepsilon R^2} + V_{\text{eff}}(R_1,R_2).
    \end{gather}
    The electrons generate an effective potential for the nuclei and the Schr\"odinger equation decouples as follows:
    \begin{align}
        \hat{H}_{\text{nucl}}(R)\psi(R) &= E\psi(R)\,,\\
        \hat{H}_{\text{el}}(r,R)\phi(r,R) &= E_{\text{el}}\phi(r,R)\,.
    \end{align}
    This is the so-called \textbf{Born--Oppenheimer approximation}. From a more modern physical perspective this approximation can also be seen to be a specific instance of renormalization theory, where the short time-scale (or, equivalently, the high energy-scale) degrees of freedom are integrated out of the theory.\index{Born--Oppenheimer approximation}

\section{Heisenberg picture}

    This is the right place to reflect on what the wave function is and how it relates to the state of a system. At every point it gives the probability of observing a particle (or whatever object is being studied). But what if one wants to express this information in terms of momenta instead of positions? The information about the state should not depend on the chosen `representation'. To this end, a state vector $|\psi\rangle$ that represents the state of the system as an abstract vector in some Hilbert space is introduced.
    \begin{notation}[Dirac notation]\index{bra-ket notation}\index{Dirac!notation}
        This notation is often called the \textbf{braket notation}. State vectors $|\psi\rangle$ are called \textbf{ket}'s and their duals $\langle\psi|$ are called \textbf{bra}'s. The inner product of a state $|\phi\rangle$ and a state $|\psi\rangle$ is denoted by $\langle\phi\mid\psi\rangle$.
    \end{notation}
    But then, how does one recover the position (configuration) representation $\psi(x)$? This is simply the projection of the state vector $|\psi\rangle$ on the `basis function' $\delta(x)$, i.e.~$\psi(x)$ represents an expansion coefficient in terms of a `basis' for the physical Hilbert space. In the same way one can obtain the momentum representation $\psi(p)$ by projecting on the plane waves $e^{ipx}$.

    \begin{remark}\index{Hilbert!rigged Hilbert space}
        It should be noted that neither the `basis states' $\delta(x)$, nor the plane waves $e^{ipx}$ are square-integrable and, hence, they are not elements of the Hilbert space $L^2(\mathbb{R},\mathbb{C})$. In the next chapter this issue will be resolved through the concept of \textit{rigged Hilbert spaces}.
    \end{remark}

    \begin{formula}[Matrix representation]
        The following formula gives the matrix representation of an operator $\hat{A}$ with respect to the orthonormal basis $\{|\psi_i\rangle\}_{i\leq n}$ cf.~\cref{linalgebra:matrix_representation}:
        \begin{gather}
            \label{wavematrix:matrix_entry}
            A_{ij} := \langle\psi_i|\hat{A}|\psi_j\rangle\,.
        \end{gather}
    \end{formula}
    \begin{remark}
         The basis $\bigl\{|\psi_i\rangle\bigr\}_{i\leq n}$ need not consist out of eigenfunctions of $\hat{A}$.
    \end{remark}

    ?? COMPLETE ??

\section{Uncertainty principle}

    \newdef{Compatible observables}{\index{observable!compatibility}
        Two observables are said to be compatible if they share a complete set of eigenvectors.
    }

    \newdef{Expectation value}{
        The expectation value of an operator $\hat{A}$ in a state $|\psi\rangle$ is defined as
        \begin{gather}
            \langle\hat{A}\rangle_\psi := \langle\psi|\hat{A}|\psi\rangle\,.
        \end{gather}
        The subscript $\psi$ is often left implicit. As in ordinary statistics \eqref{statistics:variance_without_sum}, the uncertainty or variance is defined as follows:
        \begin{gather}
            \Delta A := \langle\hat{A}^2\rangle - \langle\hat{A}\rangle^2\,.
        \end{gather}
    }

    \newformula{Uncertainty relation}{\index{Heisenberg!uncertainty relation}\index{Robertson|see{Heisenberg uncertainty relation}}
        Let $\hat{A},\hat{B}$ be two operator and let $\Delta A,\Delta B$ be the corresponding uncertainties. The (\textbf{Robertson}) uncertainty relation reads as follows:
        \begin{gather}
            \label{wavematrix:uncertainty_relation}
            \Delta A\Delta B\geq\frac{1}{4}\left|\left\langle\left[\hat{A},\hat{B}\right]\right\rangle\right|^2\,.
        \end{gather}
    }

\section{Angular Momentum}
\subsection{Angular momentum operator}

    \begin{property}[Lie algebra]
       The angular momentum operators generate a Lie algebra (\cref{lie:lie_algebra}). The Lie bracket is defined by the following commutation relation:
       \begin{gather}
           \label{angular_momentum:commutation}
           \left[\hat{J}_i,\hat{J}_j\right] = i\hbar\varepsilon_{ijk}\hat{J}_k\,.
       \end{gather}
       Since rotations correspond to actions of the orthogonal group $\mathrm{SO}(3)$ it should not come as a surprise that the above relation is that of the Lie algebra $\mathfrak{so}(3)$ from \cref{lie:so3}.
    \end{property}

    \begin{property}
       The mutual eigenbasis of $\hat{J}^2$ and $\hat{J}_z$ is defined by the following two eigenvalue equations:
       \begin{align}
           \label{angular_momentum:j}
           \hat{J}^2|j,m\rangle &= j(j+1)\hbar^2\,|j,m\rangle\,,\\
           \label{angular_momentum:m}
           \hat{J}_z|j,m\rangle &= m\hbar\,|j,m\rangle\,.
        \end{align}
    \end{property}

    \newdef{Ladder operators\footnotemark}{\index{ladder operators}
        \footnotetext{Also called the \textbf{creation} and \textbf{annihilation} operators (especially in quantum field theory).}
        The raising and lowering operators $\hat{J}_+$ and $\hat{J}_-$ are defined as follows:
        \begin{gather}
            \hat{J}_+ := \hat{J}_x + i\hat{J}_y \qquad\text{and}\qquad \hat{J}_- := \hat{J}_x - i\hat{J}_y\,.
        \end{gather}
        These operators only change the quantum number $m_z$, not the total angular momentum.
    }
    \begin{result}
        From the commutation relations of the angular momentum operators, one can derive the commutation relations of the ladder operators:
        \begin{gather}
            \left[\hat{J}_+,\hat{J}_-\right] = 2\hbar\hat{J}_z\,.
        \end{gather}
    \end{result}

    \begin{formula}
        The total angular momentum operator $\hat{J}^2$ can now be expressed in terms of $\hat{J}_z$ and the ladder operators using the commutation relation~\eqref{angular_momentum:commutation}:
        \begin{gather}
            \hat{J}^2 = \hat{J}_+\hat{J}_- + \hat{J}_z^2 - \hbar\hat{J}_z\,.
        \end{gather}
    \end{formula}
    \begin{remark}[Casimir operator]\index{Casimir!invariant}
        From the definition of $\hat{J}^2$ it follows that this operator is a Casimir invariant (\cref{lie:casimir_invariant}) of $\mathfrak{so}(3)$.
    \end{remark}

\subsection{Rotations}

    \begin{formula}
        An infinitesimal rotation $\hat{R}(\delta\vector{\varphi})$ is given by the following formula:
        \begin{gather}
            \label{angular_momentum:infinitesimal_rotation}
            \hat{R}(\delta\vector{\varphi}) = \mathbbm{1} - \frac{i}{\hbar}\vector{J}\cdot\delta\vector{\varphi}\,.
        \end{gather}
        A finite rotation can be generated by applying this infinitesimal rotation repeatedly:
        \begin{gather}
            \label{angular_momentum:finite_rotation}
            \hat{R}(\vector{\varphi}) = \left(\mathbbm{1} - \frac{i}{\hbar}\vector{J}\cdot\frac{\vector{\varphi}}{n}\right)^n = \exp\left(-\frac{i}{\hbar}\vector{J}\cdot\vector{\varphi}\right)\,.
        \end{gather}
    \end{formula}

    \newformula{Matrix elements}{\index{Wigner!$D$-function}
        Applying a rotation over an angle $\varphi$ about the $z$-axis to a state $|j,m\rangle$ gives
        \begin{gather}
            \hat{R}(\varphi\vector{e}_z)|j,m\rangle = \exp\left(-\frac{i}{\hbar}\hat{J}_z\varphi\right)|j,m\rangle = \exp\left(-\frac{i}{\hbar}m\varphi\right)|j,m\rangle\,.
        \end{gather}
        Multiplying these states with a bra $\langle j',m'|$ and using the orthonormality of the eigenstates gives the matrix elements of the rotation operator:
        \begin{gather}
            \hat{R}_{ij}(\varphi\vector{e}_z) = \exp\left(-\frac{i}{\hbar}m\varphi\right)\delta_{jj'}\delta_{mm'}\,.
        \end{gather}
        From the expression of the angular momentum operators and the rotation operator it is clear that a general rotation has no effect on the total angular momentum number $j$. This means that the rotation matrix will be block diagonal with respect to $j$. This amounts to the following reduction of the representation of the rotation group:
        \begin{gather}
            \langle j,m'|\hat{R}(\varphi\vector{n})|j,m\rangle = \mathcal{D}^{(j)}_{m,m'}(\hat{R})\,,
        \end{gather}
        where the functions $\mathcal{D}^{(j)}_{m,m'}(\hat{R})$ are called the \textbf{Wigner $D$-functions}. For every value of $j$ there are $(2j+1)$ values for $m$. This implies that the matrix $\mathcal{D}^{(j)}(\hat{R})$ is a $(2j+1)\times(2j+1)$-matrix.
    }

\subsection{Spinor representation}

    \newdef{Pauli matrices}{\index{Pauli!matrix}\label{angular_momentum:pauli_matrices}
        \begin{gather}
            \sigma_x :=
            \begin{pmatrix}
                0&1\\
                1&0
            \end{pmatrix}
            \qquad
            \sigma_y :=
            \begin{pmatrix}
                0&-i\\
                i&0
            \end{pmatrix}
            \qquad
            \sigma_z :=
            \begin{pmatrix}
                1&0\\
                0&-1
            \end{pmatrix}
        \end{gather}
        From this definition, it is clear that the Pauli matrices are Hermitian and unitary. Together with the $2\times2$ identity matrix, they form a basis for the space of $2\times2$ Hermitian matrices. For this reason, the identity matrix is often denoted by $\sigma_0$ (especially in the context of relativistic QM).
    }

    \begin{formula}
        In the spinor representation ($J=\frac{1}{2}$), the Wigner-$D$ matrix reads as follows:
        \begin{gather}
            \mathcal{D}^{(1/2)}(\varphi\vector{e}_z) =
            \begin{pmatrix}
                e^{-i/2 \varphi}&0\\
                0&e^{i/2\varphi}
            \end{pmatrix}\,.
        \end{gather}
    \end{formula}

\subsection{Coupling of angular momenta}

    Due to the tensor product structure of a coupled Hilbert space, the angular momentum operator $\hat{J}_i$ should now be interpreted as $\mathbbm{1}\otimes\cdots\otimes\hat{J}_i\otimes\cdots\otimes\mathbbm{1}$ (cf.~\cref{vector:tensor_abuse}). Because the angular momentum operators $\hat{J}_{l\neq i}$ do not act on the space $\mathcal{H}_i$, one can pull these operators through the tensor product: \[\hat{J}_i|j_1\rangle\otimes\cdots\otimes|j_n\rangle = |j_1\rangle\otimes\cdots\otimes\hat{J}_i|j_i\rangle\otimes\cdots\otimes|j_n\rangle.\] The basis used above is called the \textbf{uncoupled basis}.

    For simplicity the total Hilbert space is from here on assumed to be that of a two-particle system. Let $\hat{J}$ denote the total angular momentum defined as
    \begin{gather}
        \hat{J} = \hat{J}_1 + \hat{J}_2\,.
    \end{gather}
    With this operator one can define a \textbf{coupled} state $|J,M\rangle$, where $M$ is the total magnetic quantum number which ranges from $-J$ to $J$.

    \newformula{Clebsch--Gordan coefficients}{\index{Clebsch--Gordan coefficient}\label{angular_momentum:clebsch-gordan}
        Because both bases (coupled and uncoupled) span the total Hilbert space $\mathcal{H}$, there exists an invertible transformation between them. The transformation coefficients can be found by using the resolution of the identity:
        \begin{gather}
            |J,M\rangle = \sum_{m_1=-j_1}^{j_1}\sum_{m_2=-j_2}^{j_2}|j_1,j_2,m_1,m_2\rangle\langle j_1,j_2,m_1,m_2\mid J,M \rangle.
        \end{gather}
        These coefficients are called the Clebsch--Gordan coefficients.
    }

    \begin{property}
        By acting with the operator $\hat{J}_z$ on both sides of \cref{angular_momentum:clebsch-gordan}, it is possible to prove that the Clebsch--Gordan coefficients are nonzero if and only if $M = m_1 + m_2$.
    \end{property}

\section{Mathematical Formalization}\label{section:mathematical_formalism_qm}
\subsection{Postulates}

    \begin{axiom}[State spaces]
        The states of a (closed) system are represented by vectors in a (complex) Hilbert space. In the infinite-dimensional setting one often further restricts to separable spaces, i.e.~the spaces are required to admit a countable Hilbert basis.
    \end{axiom}

    \begin{axiom}[Observables]\index{observable}
        A self-adjoint operator. In the finite-dimensional case this is equivalent to an operator that admits a complete set of eigenfunctions.
    \end{axiom}

    \begin{axiom}[Rays]
        The dynamics of the system do not depend on the global phase or normalization, states are represented by rays in a projective Hilbert space.
    \end{axiom}

\subsection{Observables}

    \begin{formula}\index{eigenfunction!expansion}
        Let $|\Psi\rangle$ be a state vector representing a given system and let $\{|\psi_i\rangle\}_{i\in I}$ be a complete set of eigenvectors of some observable of the system. The state vector $|\Psi\rangle$ can be expressed as a linear combination of the eigenfunctions:
        \begin{gather}
            \label{qm_formalism:eigenfunction_expansion}
            |\Psi\rangle = \sum_ic_i|\psi_i\rangle + \Int c_a|\psi_a\rangle\,da\,,
        \end{gather}
        where the summation ranges over the discrete spectrum and the integral over the continuous spectrum (\cref{section:spectrum}). Note that this expression only makes sense formally, since linear combinations only consist of a finite number of terms, i.e.~$c_a$ should be a finite sum of delta functionals.
    \end{formula}

    \begin{formula}[Closure relation]\index{closure!relation}\index{resolution!of the identity}
        For a complete set of discrete eigenvectors the closure relation (also called the \textbf{resolution of the identity}) is given by
        \begin{gather}
            \label{qm_formalism:closure}
            \sum_n|\psi_n\rangle\langle\psi_n| = \mathbbm{1}\,.
        \end{gather}
        For a complete set of continuous eigenvectors the following counterpart holds:
        \begin{gather}
            \label{qm_formalism:closure_continuouos}
            \Int_{\mathcal{X}}|x\rangle\langle x|\,dx = \mathbbm{1}\,.
        \end{gather}
        For a mixed set of eigenvectors, a similar relation is obtained by summing over the discrete part and integrating over the continuous part. For simplicity, the notation of \cref{qm_formalism:closure} will also be used for the continuous part.
    \end{formula}

    \newdef{Canonical commutation relations}{\index{canonical!commutation relation}\index{Weyl!relations}\label{qm_formalism:CCR}
        \nomenclature[A_CCR]{CCR}{canonical commutation relation}
        Two observables $A,B$ are said to obey a canonical commutation relation (CCR) if they satisfy (up to a constant factor $\hbar$)
        \begin{gather}
            [A,B] = i\,.
        \end{gather}
        The prime examples are the position and momentum operators $\hat{x}, \hat{p}$. Through functional calculus one can also define the exponential operators $e^{isA}$ and $e^{itB}$. The above relation then induces the so-called \textbf{Weyl form} of the CCR:
        \begin{gather}
            e^{isA}e^{itB} = e^{ist}e^{itB}e^{isA}\,.
        \end{gather}
    }
    \begin{theorem}[Stone--von Neumann]\index{Stone--von Neumann}\label{qm_formalism:stone_von_neumann}
        All pairs of irreducible, unitary, one-parameter subgroups satisfying the Weyl form of the CCRs are unitarily equivalent.
    \end{theorem}
    \begin{result}
        The Schr\"odinger and Heisenberg pictures are unitarily equivalent.
    \end{result}

    In fact, one can generalize the Weyl form of the CCRs.
    \begin{definition}[Weyl system]\index{Weyl!system}
        Let $(A,\omega)$ be a symplectic vector space and let $\mathcal{H}$ be a Hilbert space equipped with a continuous map $W:A\rightarrow\mathrm{U}(\mathcal{H})$. This data defines a Weyl system if the following equality is satisfied for all $v,v'\in A$:
        \begin{gather}
            W(v)w(v')=e^{i\omega(v,v')/2}W(v+v')\,.
        \end{gather}
        The relation itself is called a \textbf{Weyl relation}.

        For every vector $v\in A$, the map $t\mapsto W(tv)$ is a continuous unitary one-parameter subgroup, so by Stone's theorem \ref{functional:stone} one obtains a self-adjoint generator $\phi(v)$. The map $v\mapsto\phi(v)$ is called the associated \textbf{Heisenberg system}.
    \end{definition}
    \begin{remark}
        It should be noted that the Weyl relations are more fundamental than their infinitesimal counterpart. Only the Weyl relations are well-defined on more general spaces and when passing to a relativistic setting.
    \end{remark}

\subsection{Symmetries}

    \newdef{State space}{\index{state}\index{Fubini--Study metric}
        By the postulates of quantum mechanics, the states in a quantum theory are represented by rays in the projective Hilbert space $\mathbb{P}\mathcal{H}$. Probabilities are defined through the \textit{Fubini--Study metric} on $\mathbb{P}\mathcal{H}$ as follows:
        \begin{gather}
            \mathcal{P}(\psi,\phi) := \cos^2\bigl(d_{\text{FS}}(\psi,\phi)\bigr) = \frac{|\langle\psi|\phi\rangle|^2}{\langle\psi|\psi\rangle\langle\phi|\phi\rangle}\,,
        \end{gather}
        where $|\psi\rangle,|\phi\rangle$ are representatives of the states $\psi,\phi$ in $\mathbb{P}\mathcal{H}$.
    }

    \newdef{Symmetry}{\index{symmetry!quantum}\index{automorphism!quantum}
        A quantum symmetry (or \textbf{quantum automorphism}) is an isometric automorphism of $P\mathcal{H}$. The group of these symmetries is denoted by $\Aut_{\text{QM}}(\mathbb{P}\mathcal{H})$.
    }

    The following theorem due to \textit{Wigner} gives a (linear) characterization of quantum symmetries.\footnote{It is a particular case of a more general theorem in projective geometry.}
    \begin{theorem}[Wigner]\index{Wigner}
        Every quantum automorphism of $\mathbb{P}\mathcal{H}$ is induced by a unitary or anti-unitary operator on $\mathcal{H}$.
    \end{theorem}
    This is equivalent to saying that the group morphism \[\pi:\Aut(\mathcal{H},\mathcal{P}):=\mathrm{U}(\mathcal{H})\times\mathrm{AU}(\mathcal{H})\rightarrow\Aut_{\text{QM}}(\mathbb{P}\mathcal{H})\] is surjective. Together with the kernel $\mathrm{U}(1)$, given by phase shifts, this forms a short exact sequence:
    \begin{gather}
        1\longrightarrow\mathrm{U}(1)\longrightarrow\Aut(\mathcal{H},\mathcal{P})\longrightarrow\Aut_{\text{QM}}(\mathbb{P}\mathcal{H})\longrightarrow1\,.
    \end{gather}
    In the case of symmetry breaking (e.g.~lattice systems), the full symmetry group is reduced to a subgroup $G\subset\Aut_{\text{QM}}(\mathbb{P}\mathcal{H})$. The group of operators acting on $\mathcal{H}$ is then given by the pullback $\widetilde{G}$ of the diagram \[\Aut(\mathcal{H},\mathcal{P})\longrightarrow\Aut_{\text{QM}}(\mathbb{P}\mathcal{H})\longleftarrow G\,.\] It should also be noted that the kernel of the homomorphism $\widetilde{G}\rightarrow G$ is again $\mathrm{U}(1)$. This leads to the property that $\widetilde{G}$ is a $\mathbb{Z}_2$-twisted (hence noncentral) $\mathrm{U}(1)$-extension of $G$ (where the twist is induced by the homomorphism $\phi:\Aut(\mathcal{H},\mathcal{P})\rightarrow\mathbb{Z}_2$ that says whether an operator is unitary or anti-unitary).

    ?? COMPLETE ??

\subsection{Symmetric states}

    \begin{axiom}[Symmetrization postulate]\index{symmetrization postulate}
        Let $\mathcal{H}$ be the single-particle Hilbert space. A system of $n$ identical particles is described by a state $|\Psi\rangle$ belonging to either $S^n\mathcal{H}$ or $\Lambda^n\mathcal{H}$, i.e.~\textbf{bosonic} and \textbf{fermionic} states are of the form
        \begin{gather}
            |\Psi_B\rangle = \sum_{\sigma\in S_n}|\psi_{\sigma(1)}\rangle\cdots|\psi_{\sigma(n)}\rangle
        \end{gather}
        and
        \begin{gather}
            |\Psi_F\rangle = \sum_{\sigma\in S_n}\sgn(\sigma)|\psi_{\sigma(1)}\rangle\cdots|\psi_{\sigma(n)}\rangle\,,
        \end{gather}
        respectively, where the $|\psi_i\rangle$ are single-particle states and $S_n$ is the permutation group on $n$ elements.
    \end{axiom}
    \begin{remark}\index{spin-statistics theorem}
        In ordinary quantum mechanics, this is a postulate, but in quantum field theory, this is a consequence of the \textit{spin-statistics theorem}.
    \end{remark}

    \newdef{Slater determinant}{\index{Slater!determinant}\index{spin!orbitals}\index{permanent}
        Let $\{\phi_i(\vector{q})\}_{i\leq n}$ be a set of wave functions, called \textbf{spin orbitals}, describing a system of $n$ identical fermions. The totally antisymmetric wave function of the system is given by
        \begin{gather}
            \label{qm_formalism:slater_determinant}
            \psi(\vector{q}_1,\ldots,\vector{q}_n) = \frac{1}{\sqrt{n!}}\det
            \begin{pmatrix}
                \phi_1(\vector{q}_1)&\cdots&\phi_n(\vector{q}_1)\\
                \vdots&\ddots&\vdots\\
                \phi_1(\vector{q}_n)&\cdots&\phi_n(\vector{q}_n)
            \end{pmatrix}\,.
         \end{gather}
         A similar function can be defined for bosonic systems using the concept of \textit{permanents}.
    }

\section{\difficult{Curved backgrounds}}

    Using the tools of distribution theory and differential geometry (\namecrefs{chapter:distributions}~\ref{chapter:distributions}, \ref{chapter:bundles} and onwards), one can introduce quantum mechanics on curved backgrounds (in the sense of `space', not `spacetime').

    \begin{remark}[Rigged Hilbert spaces]\index{Hilbert!rigged Hilbert space}\index{Gel'fand!triple}
        A first important remark to be made is that the classical definition of the wave function as an element of $L^2(\mathbb{R}^d,\mathbb{C})$ is not sufficient, even in flat Cartesian space. A complete description requires the introduction of so-called \textit{Gel'fand triples} or \textit{rigged Hilbert spaces}, where the space of square-integrable functions is replaced by the Schwartz space (\cref{distribution:schwartz_space}) of rapidly decreasing functions. The linear functionals on this space are then given by the tempered distributions.
    \end{remark}

    When working on curved spaces or even in non-Cartesian coordinates on flat space, one can encounter problems with the definition of the self-adjoint operators $\hat{q}^i$ and $\hat{p}_i$. The naive definition $\hat{q}^i = q^i,\hat{p}_i = -i\partial_i$ gives rise to extra terms that break the canonical commutation relations and the self-adjointness of the operators (e.g.~the angular position operator $\hat{\varphi}$ on the circle together with its conjugate $\hat{L}$) when calculating inner products.

    An elegant solution to this problem is obtained by giving up the definition of the wave function as a well-defined function $\psi:\mathbb{R}^d\rightarrow\mathbb{C}$. Assume that the physical space has the structure of a Riemannian manifold $(M,g)$ and that the `naive' wave functions take values in a vector space $V$. Then, construct a vector bundle $E$ with typical fibre $V$ over $M$. By \cref{bundle:section_bijection}, an invariant description of the `true' wave function is a map $\Psi:F(E)\rightarrow V$ or, locally, the pullback $\psi:=\varphi^*\Psi$ for some local section $\varphi:U\subseteq M\rightarrow F(E)$. The Levi-Civita connection on $M$ also induces a covariant derivative $\nabla$ on $E$ that can be used to define differential operators.

    Now, a general inner product can be introduced:
    \begin{gather}
        \langle\psi,\phi\rangle := \Int\overline{\psi(x)}\phi(x)\,dx.
    \end{gather}
    Because the factor $\sqrt{\det(g)}$ transforms in the inverse manner of the measure $dx$, the integrand is invariant under coordinate transforms (something that is generally required of physical laws). Using this new inner product one can for example check the self-adjointness of the momentum operator $\hat{P}_i := -i\nabla_i$:
    \begin{align*}
        \langle\psi,\hat{P}_i\phi\rangle = &\Int\overline{\psi(x)}(-i\nabla_i)\phi(x)\sqrt{\det(g)}\,dx\\
        \overset{\cref{bundle:local_covariant_derivative}}{=} &\Int\overline{\psi(x)}(-i\partial_i - i\omega_i)\phi(x)\sqrt{\det(g)}\,dx\\
        = &\Int\overline{(-i\partial_i\psi)(x)}\phi(x)\sqrt{\det(g)}\,dx+i\Int\overline{\psi(x)}\phi(x)\left(\partial_i\sqrt{\det(g)}\right)\,dx\\
            &\hspace{2cm} -i\Int\overline{\psi(x)}\omega_i\phi(x)\sqrt{\det(g)}\,dx\\
        = &\langle\hat{P}_i\psi,\phi\rangle -i\Int\overline{\psi(x)}\overline{\omega_i}\phi(x)\sqrt{\det(g)}\,dx\\
            &\hspace{2cm} + i\Int\overline{\psi(x)}\phi(x)\left(\partial_i\sqrt{\det(g)}\right)\,dx\\
            &\hspace{2cm} -i\Int\overline{\psi(x)}\omega_i\phi(x)\sqrt{\det(g)}\,dx\,.
    \end{align*}
    Self-adjointness then requires that
    \begin{gather}
        \sqrt{\det(g)}(\omega_i + \overline{\omega_i}) = \partial_i\sqrt{\det(g)}
    \end{gather}
    or
    \begin{gather}
        2\mathrm{Re}(\omega_i) = \partial_i\ln\left(\sqrt{\det(g)}\right)\,.
    \end{gather}
    ?? COMPLETE ??

\section{\difficult{Topos theory}}

    \newdef{Bohr topos}{\index{Bohr!topos}\index{Alexandrov!topology}
        Consider a $C^*$-algebra $A$ of bounded observables on a Hilbert space $\mathcal{H}$. Denote by $\mathrm{ComSub}(A)$ the poset (\cref{set:poset}) of commutative $C^*$-subalgebras. This set can be equipped with the \textbf{Alexandrov topology}\footnote{There exist an equivalences $\mathbf{Pre}\cong\mathbf{AlexTop}$ and $\mathbf{Pos}\cong\mathbf{AlexTop}_{T_0}$.}, i.e.~the topology for which the open sets are the upward closed subsets. The topological space $(\mathrm{ComSub}(A),\tau_{\text{Alex}})$ is called the Bohr site of $A$.

        The sheaf topos over the Bohr site is called the Bohr topos $\mathbf{Bohr}(A)$. It can be turned into a ringed topos, where the ring object (even an internal commutative $C^*$-algebra) is given by the tautological functor
        \begin{gather}
            \underline{A}:\mathrm{ComSub}(A)\rightarrow\mathbf{Set}:C\mapsto C\,.
        \end{gather}
    }

    \begin{property}\label{quantum:topos_morphisms}
        A morphism in $\mathbf{C^*Alg}$ is commutativity-reflecting if and only if the induced morphism on posets admits a right adjoint.

        Moreover, there exists a bijection between the following two classes of morphisms:
        \begin{itemize}
            \item Geometric morphisms $f:\mathrm{Bohr}(B)\rightarrow\mathrm{Bohr}(A)$ admitting a right adjoint together with epimorphisms of internal algebras $\underline{A}\rightarrow f^*\underline{B}$.
            \item Commutativity-reflecting functions $f:A\rightarrow B$ that restrict to algebra morphisms on all commutative subalgebras.
        \end{itemize}
    \end{property}

    \newdef{Spectral presheaf}{\index{spectral!presheaf}
        The presheaf on a Bohr site assigning to every commutative subalgebra its Gel'fand spectrum.
    }
    \begin{theorem}[Kochen--Specker]\index{Kochen--Specker}
        If $A=\mathcal{B}(\mathcal{H})$ with $\dim(\mathcal{H})>2$, the spectral presheaf has no global element.
    \end{theorem}

    \begin{property}[Gleason's theorem]\index{Gleason}
        There exists a natural bijection between the quantum states of a $C^*$-algebra $A$ and the classical states of $\underline{A}$ internal to $\mathbf{Bohr}(A)$.
    \end{property}

    \newdef{Bohrification}{\index{Bohrification}
        Consider a $C^*$-algebra $A$ together with its Bohr topos $\mathrm{Bohr}(A)$. To its internal $C^*$-algebra $\underline{A}$, one can assign an internal locale $\underline{\Sigma}_A$ by (internal) Gel'fand duality (\cref{operators:gelfand_spectrum}). Under the equivalence~\ref{topos:slice_locale}, one then obtains a locale $\Sigma_A$. The functor
        \begin{gather}
            \func{\Sigma}{C^*Alg}{Loc}:A\mapsto\Sigma_A
        \end{gather}
        is called Bohrification. This locale can be constructed as the disjoint union
        \begin{gather}
            \Sigma_A = \bigsqcup_{C\in\mathrm{ComSub}(A)}\Phi_C\,,
        \end{gather}
        the \'etale locale corresponding to the spectral presheaf. Its open sets are given by those subsets whose restrictions to commutative subalgebras are open such that these restrictions are compatible with subalgebra inclusions.

        This topological bundle $\Sigma_A\rightarrow\mathrm{Alex}(\mathrm{ComSub}(A))$ also admits a topos-theoretic incarnation. There exists a (canonical) morphism of ringed topoi
        \begin{gather}
            \pi:\mathrm{Bohr}(A)\rightarrow\bigl(\mathbf{Sh}(\mathrm{Alex}(\mathrm{ComSub}(A))),\underline{\mathbb{R}}\bigr)\,,
        \end{gather}
        whose underlying geometric morphism is simply the identity.
    }
    \begin{example}[Gel'fand spectrum]\index{Gel'fand!spectrum}\index{topology!double negation}
        If $A$ is a commutative $C^*$-algebra, its Bohrification is not isomorphic to its ordinary Gel'fand spectrum $\Phi_A$. However, after replacing the topology on $\mathrm{Bohr}(A)$ by the \textit{double negation topology} and repeating the above construction one obtains
        \begin{gather}
            \Phi_A\cong\Sigma^{\lnot\lnot}_A\,.
        \end{gather}
    \end{example}

    \begin{property}[States]\index{state}
        A positive and normalized section of the morphism $\pi:\mathrm{Bohr}(A)\rightarrow\bigl(\mathbf{Sh}(\mathrm{Alex}(\mathrm{ComSub}(A))),\underline{\mathbb{R}}\bigr)$ in the category of $\mathbb{R}$-\textit{moduled} topoi.
    \end{property}

    By \cref{quantum:topos_morphisms} above, the following relation is obtained.
    \begin{property}[Observables]\index{observable}
        Morphisms $\mathrm{Bohr}(A)\rightarrow\mathrm{Bohr}(C(\mathbb{R})_0)$ admitting a right adjoint together with an epimorphism $C_0(\mathbb{R})\rightarrow A$ correspond to observables on $A$.
    \end{property}